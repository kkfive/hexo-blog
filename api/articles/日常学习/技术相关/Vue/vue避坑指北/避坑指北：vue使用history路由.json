{"title":"避坑指北：vue使用history路由","slug":"日常学习/技术相关/Vue/vue避坑指北/避坑指北：vue使用history路由","date":"2021-12-05T01:49:00.000Z","updated":"2022-02-21T13:24:30.864Z","comments":true,"path":"api/articles/日常学习/技术相关/Vue/vue避坑指北/避坑指北：vue使用history路由.json","excerpt":null,"covers":null,"content":"<h2 id=\"背景\"><a class=\"markdownIt-Anchor\" href=\"#背景\"></a> 背景</h2>\n<p>在部署vue项目时，路由模式默认使用哈希(hash)模式，但是由于某些原因，要求使用history模式。但是对于现在的部署环境则遇到了一个问题。首先是目录：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">site ---- 项目根目录\n ├── siteA ---- 项目A\n │   └── index.html\n └── siteB ---- 项目B\n     └── index.html<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>即项目放在了同一个根目录下，那么此时我们就需要调整vue的一些配置。具体如下</p>\n<h2 id=\"vue项目配置\"><a class=\"markdownIt-Anchor\" href=\"#vue项目配置\"></a> Vue项目配置</h2>\n<h2 id=\"路由设置\"><a class=\"markdownIt-Anchor\" href=\"#路由设置\"></a> 路由设置</h2>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>\n    path<span class=\"token operator\">:</span> <span class=\"token string\">'/siteA'</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'siteARoot'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">component</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@/views/siteA/index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">&#123;</span>\n            path<span class=\"token operator\">:</span> <span class=\"token string\">'index'</span><span class=\"token punctuation\">,</span>\n            name<span class=\"token operator\">:</span> <span class=\"token string\">'Index'</span><span class=\"token punctuation\">,</span>\n            meta<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">'siteA'</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function-variable function\">component</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@/views/siteA/index'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>即路由需要包含此项目部署时所需要存放的目录名。</p>\n<h3 id=\"打包配置\"><a class=\"markdownIt-Anchor\" href=\"#打包配置\"></a> 打包配置</h3>\n<p>打包配置时由于使用了history模式，那么<code>publicPath</code>就需要指定绝对路径。</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token punctuation\">&#123;</span>\n    publicPath<span class=\"token operator\">:</span> /siteA/\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>这里设置的绝对路径即项目配置时的目录名，可通过环境变量进行动态修改。</p>\n<h2 id=\"nginx配置\"><a class=\"markdownIt-Anchor\" href=\"#nginx配置\"></a> Nginx配置</h2>\n<pre class=\"line-numbers language-nginx\" data-language=\"nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">server</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">listen</span>        <span class=\"token number\">10085</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">server_name</span>  localhost<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">root</span>   <span class=\"token string\">\"D:/code/test/site/\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span>siteA <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span><span class=\"token operator\">/</span> <span class=\"token operator\">/</span>siteA<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span>siteB <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span><span class=\"token operator\">/</span> <span class=\"token operator\">/</span>siteB<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","more":"<h2 id=\"背景\"><a class=\"markdownIt-Anchor\" href=\"#背景\"></a> 背景</h2>\n<p>在部署vue项目时，路由模式默认使用哈希(hash)模式，但是由于某些原因，要求使用history模式。但是对于现在的部署环境则遇到了一个问题。首先是目录：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">site ---- 项目根目录\n ├── siteA ---- 项目A\n │   └── index.html\n └── siteB ---- 项目B\n     └── index.html<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>即项目放在了同一个根目录下，那么此时我们就需要调整vue的一些配置。具体如下</p>\n<h2 id=\"vue项目配置\"><a class=\"markdownIt-Anchor\" href=\"#vue项目配置\"></a> Vue项目配置</h2>\n<h2 id=\"路由设置\"><a class=\"markdownIt-Anchor\" href=\"#路由设置\"></a> 路由设置</h2>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>\n    path<span class=\"token operator\">:</span> <span class=\"token string\">'/siteA'</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'siteARoot'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">component</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@/views/siteA/index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">&#123;</span>\n            path<span class=\"token operator\">:</span> <span class=\"token string\">'index'</span><span class=\"token punctuation\">,</span>\n            name<span class=\"token operator\">:</span> <span class=\"token string\">'Index'</span><span class=\"token punctuation\">,</span>\n            meta<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">'siteA'</span>\n            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function-variable function\">component</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@/views/siteA/index'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>即路由需要包含此项目部署时所需要存放的目录名。</p>\n<h3 id=\"打包配置\"><a class=\"markdownIt-Anchor\" href=\"#打包配置\"></a> 打包配置</h3>\n<p>打包配置时由于使用了history模式，那么<code>publicPath</code>就需要指定绝对路径。</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token punctuation\">&#123;</span>\n    publicPath<span class=\"token operator\">:</span> /siteA/\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>这里设置的绝对路径即项目配置时的目录名，可通过环境变量进行动态修改。</p>\n<h2 id=\"nginx配置\"><a class=\"markdownIt-Anchor\" href=\"#nginx配置\"></a> Nginx配置</h2>\n<pre class=\"line-numbers language-nginx\" data-language=\"nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">server</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">listen</span>        <span class=\"token number\">10085</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">server_name</span>  localhost<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">root</span>   <span class=\"token string\">\"D:/code/test/site/\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span>siteA <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span><span class=\"token operator\">/</span> <span class=\"token operator\">/</span>siteA<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span>siteB <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token variable\">$uri</span><span class=\"token operator\">/</span> <span class=\"token operator\">/</span>siteB<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","categories":[{"name":"Vue","path":"api/categories/Vue.json"},{"name":"Vue避坑指北","path":"api/categories/Vue避坑指北.json"}],"tags":[{"name":"Vue","path":"api/tags/Vue.json"},{"name":"history路由","path":"api/tags/history路由.json"}]}