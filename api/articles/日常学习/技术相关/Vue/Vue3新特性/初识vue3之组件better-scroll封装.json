{"title":"初识vue3之better-scroll组件封装","slug":"日常学习/技术相关/Vue/Vue3新特性/初识vue3之组件better-scroll封装","date":"2021-11-27T13:17:25.000Z","updated":"2022-02-21T07:18:57.053Z","comments":true,"path":"api/articles/日常学习/技术相关/Vue/Vue3新特性/初识vue3之组件better-scroll封装.json","excerpt":null,"covers":null,"content":"<h2 id=\"关于此分类\"><a class=\"markdownIt-Anchor\" href=\"#关于此分类\"></a> 关于此分类</h2>\n<p>关于<a href=\"/categories/Vue/%E5%88%9D%E8%AF%86Vue3/\">初识 vue3</a>分类主要是记录一些通过 vue3 进行的实践与学习记录。</p>\n<blockquote>\n<p>此文主要记录封装基于<a href=\"https://better-scroll.github.io/docs/zh-CN/\">BetterScroll 2.0</a>插件封装的 scroll-view 组件。适用于移动端的弹性滚动及下拉刷新、上拉加载等场景。</p>\n<div class=\"checkbox green checked\">\n  <input type=\"checkbox\" checked />\n  <p>弹性滚动</p>\n</div>\n<div class=\"checkbox green checked\">\n  <input type=\"checkbox\" checked/>\n  <p>下拉加载</p>\n</div>\n<div class=\"checkbox green checked\">\n  <input type=\"checkbox\" checked/>\n  <p>上拉刷新</p>\n</div>\n<div class=\"checkbox green \">\n  <input type=\"checkbox\" checked />\n  <p>滚动前后及滚动中事件</p>\n</div>\n<div class=\"checkbox yellow\">\n  <input type=\"checkbox\" />\n  <p>滚动条（待添加）</p>\n</div>\n</blockquote>\n<p><strong><a href=\"/posts/909b483c/\">本文</a>会随着<a href=\"https://xiaokang.me/\">作者</a>日常使用进行补充及内容修正</strong></p>\n<h2 id=\"简单的实现过程\"><a class=\"markdownIt-Anchor\" href=\"#简单的实现过程\"></a> 简单的实现过程</h2>\n<p>实现之前需要先明确一下需求：</p>\n<ol>\n<li>弹性滚动</li>\n<li>下拉刷新、上拉加载</li>\n<li>自定义传入内容</li>\n<li>事件派发</li>\n</ol>\n<h3 id=\"弹性滚动\"><a class=\"markdownIt-Anchor\" href=\"#弹性滚动\"></a> 弹性滚动</h3>\n<p>实现弹性滚动只需要按照官方示例初始化即可实现。</p>\n<pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">&lt;template&gt;\n  &lt;div class&#x3D;&quot;wrapper&quot; ref&#x3D;&quot;wrapper&quot;&gt;\n    &lt;div class&#x3D;&quot;content&quot;&gt;\n      &lt;div v-for&#x3D;&quot;i in 100&quot;&gt;&#123;&#123; i &#125;&#125;&lt;&#x2F;div&gt;\n    &lt;&#x2F;div&gt;\n  &lt;&#x2F;div&gt;\n&lt;&#x2F;template&gt;\n&lt;script setup lang&#x3D;&quot;ts&quot;&gt;\nimport BScroll from &#39;@better-scroll&#x2F;core&#39;\nimport &#123; onMounted &#125; from &#39;vue&#39;\nlet bscroll: BScroll\nconst wrapper &#x3D; ref(null)\nonMounted(() &#x3D;&gt; &#123;\n  bscroll &#x3D; new BScroll(wrapper.value, &#123;\n    mouseWheel: true\n  &#125;)\n&#125;)\n&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>只需要在 mounted 阶段进行初始化创建对象即可。</p>\n<h3 id=\"下拉刷新-上拉加载\"><a class=\"markdownIt-Anchor\" href=\"#下拉刷新-上拉加载\"></a> 下拉刷新、上拉加载</h3>\n<p>由于我安装的是<code>@better-scroll/core</code>，并没有安装‘全量包’ ，因此实现此功能同样需要安装其他两个插件：<code>@better-scroll/pull-up</code>、<code>@better-scroll/pull-down</code></p>\n<p>安装后在初始化时开启选项即可。</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BScroll <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/core'</span>\n<span class=\"token keyword\">import</span> Pullup <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-up'</span>\n<span class=\"token keyword\">import</span> Pulldown <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-down'</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pullup<span class=\"token punctuation\">)</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pulldown<span class=\"token punctuation\">)</span>\nbscroll <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BScroll</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n  mouseWheel<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullDownRefresh<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullUpLoad<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>对于其触发事件的监听需要用实例对象去监听：</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BScroll <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/core'</span>\n<span class=\"token keyword\">import</span> Pullup <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-up'</span>\n<span class=\"token keyword\">import</span> Pulldown <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-down'</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pullup<span class=\"token punctuation\">)</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pulldown<span class=\"token punctuation\">)</span>\nbscroll <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BScroll</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.wrapper'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n  mouseWheel<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullDownRefresh<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullUpLoad<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\nbscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingUp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'触发了上拉'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\nbscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingUp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'触发了下拉'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"自定义传入内容\"><a class=\"markdownIt-Anchor\" href=\"#自定义传入内容\"></a> 自定义传入内容</h3>\n<p>自定义传入内容这里，由于我并不想传入一个数据列表，然后去渲染元素。因此通过<code>watch</code>监听 props 传入的数据这个方法就不好用了；监听<code>slots</code>里的变化通过一番尝试，最终也是失败，因此最终选择了使用官方提供的插件：<code>@better-scroll/observe-dom</code>、<code>@better-scroll/observe-image</code>进行自动更新实例对象。安装完成后只需要在初始化前<code>use</code>此插件即可。</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BScroll <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/core'</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>ObserveDOM<span class=\"token punctuation\">)</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>ObserveImage<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"事件派发\"><a class=\"markdownIt-Anchor\" href=\"#事件派发\"></a> 事件派发</h3>\n<p>需要派发的事件大致为：滚动事件和上拉下拉事件</p>\n<ol>\n<li>\n<p>滚动事件</p>\n<p>此类事件只需要正常 emit 即可。</p>\n</li>\n<li>\n<p>上拉下拉事件</p>\n<p>上拉下拉刷新需要调用对应的结束事件才可以，因此将其封装为组件时就会遇到一个问题即需要等传入函数执行完毕后在调用结束事件。</p>\n</li>\n</ol>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> defineProps<span class=\"token punctuation\">,</span> PropType<span class=\"token punctuation\">,</span> defineEmits <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span>\n<span class=\"token keyword\">const</span> emit <span class=\"token operator\">=</span> <span class=\"token function\">defineEmits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ckick'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'beforeScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'afterScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scroll'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> emit <span class=\"token operator\">=</span> <span class=\"token function\">defineEmits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ckick'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'beforeScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'afterScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scroll'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token function\">defineProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token comment\">/**\n   * 是否派发滚动事件\n   */</span>\n  listenScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发滚动到底部的事件，用于上拉加载\n   */</span>\n  pullup<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发顶部下拉的事件，用于下拉刷新\n   */</span>\n  pulldown<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发列表滚动开始的事件\n   */</span>\n  beforeScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发列表滚动开始的事件\n   */</span>\n  afterScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">/**\n * 如果开启了滚动前事件派发\n */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>beforeScroll<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'beforeScrollStart'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'beforeScroll'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">/**\n * 如果开启了滚动(滚动中)事件派发\n */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>listenScroll<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>position<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> y<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">/**\n * 如果开启了滚动结束事件派发\n */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>beforeScroll<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scrollEnd'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'afterScroll'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>pullup <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingUp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n      props<span class=\"token punctuation\">.</span><span class=\"token function\">pullup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// 传入非 Promise 函数</span>\n      bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>pulldown <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingDown'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n      props<span class=\"token punctuation\">.</span><span class=\"token function\">pulldown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// 传入非 Promise 函数</span>\n      bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"完整代码\"><a class=\"markdownIt-Anchor\" href=\"#完整代码\"></a> 完整代码</h2>\n<pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">&lt;template&gt;\n  &lt;div :class&#x3D;&quot;&#123; wrapper: true, x: props.scrollX &#125;&quot; ref&#x3D;&quot;wrapper&quot;&gt;\n    &lt;div class&#x3D;&quot;content&quot;&gt;\n      &lt;slot&gt;&lt;&#x2F;slot&gt;\n    &lt;&#x2F;div&gt;\n  &lt;&#x2F;div&gt;\n&lt;&#x2F;template&gt;\n\n&lt;script setup lang&#x3D;&quot;ts&quot;&gt;\nimport &#123; onMounted, defineProps, PropType, defineEmits &#125; from &#39;vue&#39;\n\nimport BScroll from &#39;@better-scroll&#x2F;core&#39;\nimport ObserveDOM from &#39;@better-scroll&#x2F;observe-dom&#39;\nimport ObserveImage from &#39;@better-scroll&#x2F;observe-image&#39;\nimport Pullup from &#39;@better-scroll&#x2F;pull-up&#39;\nimport Pulldown from &#39;@better-scroll&#x2F;pull-down&#39;\nlet bscroll: BScroll\nconst wrapper &#x3D; ref(null)\nBScroll.use(ObserveDOM)\nBScroll.use(ObserveImage)\nBScroll.use(Pullup)\nBScroll.use(Pulldown)\nconst emit &#x3D; defineEmits([&#39;ckick&#39;, &#39;beforeScroll&#39;, &#39;afterScroll&#39;, &#39;scroll&#39;])\nconst props &#x3D; defineProps(&#123;\n  &#x2F;**\n   * 1 滚动的时候会派发scroll事件，会截流。\n   * 2 滚动的时候实时派发scroll事件，不会截流。\n   * 3 除了实时派发scroll事件，在swipe的情况下仍然能实时派发scroll事件\n   *&#x2F;\n  probeType: &#123;\n    type: Number as PropType&lt;1 | 2 | 3&gt;,\n    required: false,\n    default: 1\n  &#125;,\n\n  &#x2F;**\n   * 是否开启横向滚动，默认纵向滚动。\n   * 开启横向滚动需要将传入元素设置为横向例如：display:inline-block\n   *&#x2F;\n  scrollX: &#123;\n    type: Boolean,\n    required: false,\n    default: false\n  &#125;,\n\n  &#x2F;**\n   * 点击列表是否派发click事件\n   *&#x2F;\n  click: &#123;\n    type: Boolean,\n    default: true\n  &#125;,\n  &#x2F;**\n   * 是否派发滚动事件\n   *&#x2F;\n  listenScroll: &#123;\n    type: Boolean,\n    default: false\n  &#125;,\n  &#x2F;**\n   * 是否派发滚动到底部的事件，用于上拉加载\n   *&#x2F;\n  pullup: &#123;\n    type: Function,\n    default: null\n  &#125;,\n  &#x2F;**\n   * 是否派发顶部下拉的事件，用于下拉刷新\n   *&#x2F;\n  pulldown: &#123;\n    type: Function,\n    default: null\n  &#125;,\n  &#x2F;**\n   * 是否派发列表滚动开始的事件\n   *&#x2F;\n  beforeScroll: &#123;\n    type: Boolean,\n    default: false\n  &#125;,\n  &#x2F;**\n   * 是否派发列表滚动开始的事件\n   *&#x2F;\n  afterScroll: &#123;\n    type: Boolean,\n    default: false\n  &#125;\n&#125;)\n\nonMounted(() &#x3D;&gt; &#123;\n  bscroll &#x3D; new BScroll(wrapper.value, &#123;\n    scrollX: props.scrollX,\n    probeType: props.probeType,\n    click: props.click,\n    observeDOM: true,\n    observeImage: true,\n    mouseWheel: true,\n    pullDownRefresh: true,\n    pullUpLoad: true\n  &#125;)\n  &#x2F;**\n   * 如果开启了滚动前事件派发\n   *&#x2F;\n  if (props.beforeScroll) &#123;\n    bscroll.on(&#39;beforeScrollStart&#39;, () &#x3D;&gt; &#123;\n      emit(&#39;beforeScroll&#39;)\n    &#125;)\n  &#125;\n\n  &#x2F;**\n   * 如果开启了滚动(滚动中)事件派发\n   *&#x2F;\n  if (props.listenScroll) &#123;\n    bscroll.on(&#39;scroll&#39;, (position: &#123; x: number; y: number &#125;) &#x3D;&gt; &#123;\n      emit(&#39;scroll&#39;, position)\n    &#125;)\n  &#125;\n\n  &#x2F;**\n   * 如果开启了滚动结束事件派发\n   *&#x2F;\n  if (props.beforeScroll) &#123;\n    bscroll.on(&#39;scrollEnd&#39;, () &#x3D;&gt; &#123;\n      emit(&#39;afterScroll&#39;)\n    &#125;)\n  &#125;\n\n  if (props.pullup !&#x3D;&#x3D; null) &#123;\n    bscroll.on(&#39;pullingUp&#39;, () &#x3D;&gt; &#123;\n      try &#123;\n        props.pullup().then(() &#x3D;&gt; &#123;\n          bscroll.finishPullUp()\n        &#125;)\n      &#125; catch (e) &#123;\n        &#x2F;&#x2F; 传入非 Promise 函数\n        bscroll.finishPullUp()\n      &#125;\n    &#125;)\n  &#125;\n\n  if (props.pulldown !&#x3D;&#x3D; null) &#123;\n    bscroll.on(&#39;pullingDown&#39;, () &#x3D;&gt; &#123;\n      try &#123;\n        props.pulldown().then(() &#x3D;&gt; &#123;\n          bscroll.finishPullDown()\n        &#125;)\n      &#125; catch (e) &#123;\n        &#x2F;&#x2F; 传入非 Promise 函数\n        bscroll.finishPullDown()\n      &#125;\n    &#125;)\n  &#125;\n&#125;)\n&lt;&#x2F;script&gt;\n\n&lt;style scoped lang&#x3D;&quot;scss&quot;&gt;\n@import &#39;.&#x2F;index.scss&#39;;\n&lt;&#x2F;style&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-scss\" data-language=\"scss\"><code class=\"language-scss\"><span class=\"token selector\">.wrapper </span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n  <span class=\"token selector\">.content </span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token comment\">// 开启横向滚动</span>\n  <span class=\"token selector\"><span class=\"token parent important\">&amp;</span>.x </span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span> nowrap<span class=\"token punctuation\">;</span>\n    <span class=\"token selector\">.content </span><span class=\"token punctuation\">&#123;</span>\n      <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-block<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>外部使用时需要传入样式指定宽高</p>\n<pre class=\"line-numbers language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scroll-view</span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 300px<span class=\"token punctuation\">;</span> <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 300px</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>i in count<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>i<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>当前第&#123;&#123; i &#125;&#125;个元素<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scroll-view</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n","more":"<h2 id=\"关于此分类\"><a class=\"markdownIt-Anchor\" href=\"#关于此分类\"></a> 关于此分类</h2>\n<p>关于<a href=\"/categories/Vue/%E5%88%9D%E8%AF%86Vue3/\">初识 vue3</a>分类主要是记录一些通过 vue3 进行的实践与学习记录。</p>\n<blockquote>\n<p>此文主要记录封装基于<a href=\"https://better-scroll.github.io/docs/zh-CN/\">BetterScroll 2.0</a>插件封装的 scroll-view 组件。适用于移动端的弹性滚动及下拉刷新、上拉加载等场景。</p>\n<div class=\"checkbox green checked\">\n  <input type=\"checkbox\" checked />\n  <p>弹性滚动</p>\n</div>\n<div class=\"checkbox green checked\">\n  <input type=\"checkbox\" checked/>\n  <p>下拉加载</p>\n</div>\n<div class=\"checkbox green checked\">\n  <input type=\"checkbox\" checked/>\n  <p>上拉刷新</p>\n</div>\n<div class=\"checkbox green \">\n  <input type=\"checkbox\" checked />\n  <p>滚动前后及滚动中事件</p>\n</div>\n<div class=\"checkbox yellow\">\n  <input type=\"checkbox\" />\n  <p>滚动条（待添加）</p>\n</div>\n</blockquote>\n<p><strong><a href=\"/posts/909b483c/\">本文</a>会随着<a href=\"https://xiaokang.me/\">作者</a>日常使用进行补充及内容修正</strong></p>\n<h2 id=\"简单的实现过程\"><a class=\"markdownIt-Anchor\" href=\"#简单的实现过程\"></a> 简单的实现过程</h2>\n<p>实现之前需要先明确一下需求：</p>\n<ol>\n<li>弹性滚动</li>\n<li>下拉刷新、上拉加载</li>\n<li>自定义传入内容</li>\n<li>事件派发</li>\n</ol>\n<h3 id=\"弹性滚动\"><a class=\"markdownIt-Anchor\" href=\"#弹性滚动\"></a> 弹性滚动</h3>\n<p>实现弹性滚动只需要按照官方示例初始化即可实现。</p>\n<pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">&lt;template&gt;\n  &lt;div class&#x3D;&quot;wrapper&quot; ref&#x3D;&quot;wrapper&quot;&gt;\n    &lt;div class&#x3D;&quot;content&quot;&gt;\n      &lt;div v-for&#x3D;&quot;i in 100&quot;&gt;&#123;&#123; i &#125;&#125;&lt;&#x2F;div&gt;\n    &lt;&#x2F;div&gt;\n  &lt;&#x2F;div&gt;\n&lt;&#x2F;template&gt;\n&lt;script setup lang&#x3D;&quot;ts&quot;&gt;\nimport BScroll from &#39;@better-scroll&#x2F;core&#39;\nimport &#123; onMounted &#125; from &#39;vue&#39;\nlet bscroll: BScroll\nconst wrapper &#x3D; ref(null)\nonMounted(() &#x3D;&gt; &#123;\n  bscroll &#x3D; new BScroll(wrapper.value, &#123;\n    mouseWheel: true\n  &#125;)\n&#125;)\n&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>只需要在 mounted 阶段进行初始化创建对象即可。</p>\n<h3 id=\"下拉刷新-上拉加载\"><a class=\"markdownIt-Anchor\" href=\"#下拉刷新-上拉加载\"></a> 下拉刷新、上拉加载</h3>\n<p>由于我安装的是<code>@better-scroll/core</code>，并没有安装‘全量包’ ，因此实现此功能同样需要安装其他两个插件：<code>@better-scroll/pull-up</code>、<code>@better-scroll/pull-down</code></p>\n<p>安装后在初始化时开启选项即可。</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BScroll <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/core'</span>\n<span class=\"token keyword\">import</span> Pullup <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-up'</span>\n<span class=\"token keyword\">import</span> Pulldown <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-down'</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pullup<span class=\"token punctuation\">)</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pulldown<span class=\"token punctuation\">)</span>\nbscroll <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BScroll</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n  mouseWheel<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullDownRefresh<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullUpLoad<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>对于其触发事件的监听需要用实例对象去监听：</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BScroll <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/core'</span>\n<span class=\"token keyword\">import</span> Pullup <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-up'</span>\n<span class=\"token keyword\">import</span> Pulldown <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/pull-down'</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pullup<span class=\"token punctuation\">)</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Pulldown<span class=\"token punctuation\">)</span>\nbscroll <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BScroll</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.wrapper'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n  mouseWheel<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullDownRefresh<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  pullUpLoad<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\nbscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingUp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'触发了上拉'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\nbscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingUp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'触发了下拉'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"自定义传入内容\"><a class=\"markdownIt-Anchor\" href=\"#自定义传入内容\"></a> 自定义传入内容</h3>\n<p>自定义传入内容这里，由于我并不想传入一个数据列表，然后去渲染元素。因此通过<code>watch</code>监听 props 传入的数据这个方法就不好用了；监听<code>slots</code>里的变化通过一番尝试，最终也是失败，因此最终选择了使用官方提供的插件：<code>@better-scroll/observe-dom</code>、<code>@better-scroll/observe-image</code>进行自动更新实例对象。安装完成后只需要在初始化前<code>use</code>此插件即可。</p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BScroll <span class=\"token keyword\">from</span> <span class=\"token string\">'@better-scroll/core'</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>ObserveDOM<span class=\"token punctuation\">)</span>\nBScroll<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>ObserveImage<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"事件派发\"><a class=\"markdownIt-Anchor\" href=\"#事件派发\"></a> 事件派发</h3>\n<p>需要派发的事件大致为：滚动事件和上拉下拉事件</p>\n<ol>\n<li>\n<p>滚动事件</p>\n<p>此类事件只需要正常 emit 即可。</p>\n</li>\n<li>\n<p>上拉下拉事件</p>\n<p>上拉下拉刷新需要调用对应的结束事件才可以，因此将其封装为组件时就会遇到一个问题即需要等传入函数执行完毕后在调用结束事件。</p>\n</li>\n</ol>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> defineProps<span class=\"token punctuation\">,</span> PropType<span class=\"token punctuation\">,</span> defineEmits <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span>\n<span class=\"token keyword\">const</span> emit <span class=\"token operator\">=</span> <span class=\"token function\">defineEmits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ckick'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'beforeScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'afterScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scroll'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> emit <span class=\"token operator\">=</span> <span class=\"token function\">defineEmits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ckick'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'beforeScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'afterScroll'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scroll'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token function\">defineProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token comment\">/**\n   * 是否派发滚动事件\n   */</span>\n  listenScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发滚动到底部的事件，用于上拉加载\n   */</span>\n  pullup<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发顶部下拉的事件，用于下拉刷新\n   */</span>\n  pulldown<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发列表滚动开始的事件\n   */</span>\n  beforeScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">/**\n   * 是否派发列表滚动开始的事件\n   */</span>\n  afterScroll<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">type</span><span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">/**\n * 如果开启了滚动前事件派发\n */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>beforeScroll<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'beforeScrollStart'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'beforeScroll'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">/**\n * 如果开启了滚动(滚动中)事件派发\n */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>listenScroll<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>position<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> y<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> position<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">/**\n * 如果开启了滚动结束事件派发\n */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>beforeScroll<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scrollEnd'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'afterScroll'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>pullup <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingUp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n      props<span class=\"token punctuation\">.</span><span class=\"token function\">pullup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// 传入非 Promise 函数</span>\n      bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>pulldown <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pullingDown'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n      props<span class=\"token punctuation\">.</span><span class=\"token function\">pulldown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n        bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token comment\">// 传入非 Promise 函数</span>\n      bscroll<span class=\"token punctuation\">.</span><span class=\"token function\">finishPullDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"完整代码\"><a class=\"markdownIt-Anchor\" href=\"#完整代码\"></a> 完整代码</h2>\n<pre class=\"line-numbers language-vue\" data-language=\"vue\"><code class=\"language-vue\">&lt;template&gt;\n  &lt;div :class&#x3D;&quot;&#123; wrapper: true, x: props.scrollX &#125;&quot; ref&#x3D;&quot;wrapper&quot;&gt;\n    &lt;div class&#x3D;&quot;content&quot;&gt;\n      &lt;slot&gt;&lt;&#x2F;slot&gt;\n    &lt;&#x2F;div&gt;\n  &lt;&#x2F;div&gt;\n&lt;&#x2F;template&gt;\n\n&lt;script setup lang&#x3D;&quot;ts&quot;&gt;\nimport &#123; onMounted, defineProps, PropType, defineEmits &#125; from &#39;vue&#39;\n\nimport BScroll from &#39;@better-scroll&#x2F;core&#39;\nimport ObserveDOM from &#39;@better-scroll&#x2F;observe-dom&#39;\nimport ObserveImage from &#39;@better-scroll&#x2F;observe-image&#39;\nimport Pullup from &#39;@better-scroll&#x2F;pull-up&#39;\nimport Pulldown from &#39;@better-scroll&#x2F;pull-down&#39;\nlet bscroll: BScroll\nconst wrapper &#x3D; ref(null)\nBScroll.use(ObserveDOM)\nBScroll.use(ObserveImage)\nBScroll.use(Pullup)\nBScroll.use(Pulldown)\nconst emit &#x3D; defineEmits([&#39;ckick&#39;, &#39;beforeScroll&#39;, &#39;afterScroll&#39;, &#39;scroll&#39;])\nconst props &#x3D; defineProps(&#123;\n  &#x2F;**\n   * 1 滚动的时候会派发scroll事件，会截流。\n   * 2 滚动的时候实时派发scroll事件，不会截流。\n   * 3 除了实时派发scroll事件，在swipe的情况下仍然能实时派发scroll事件\n   *&#x2F;\n  probeType: &#123;\n    type: Number as PropType&lt;1 | 2 | 3&gt;,\n    required: false,\n    default: 1\n  &#125;,\n\n  &#x2F;**\n   * 是否开启横向滚动，默认纵向滚动。\n   * 开启横向滚动需要将传入元素设置为横向例如：display:inline-block\n   *&#x2F;\n  scrollX: &#123;\n    type: Boolean,\n    required: false,\n    default: false\n  &#125;,\n\n  &#x2F;**\n   * 点击列表是否派发click事件\n   *&#x2F;\n  click: &#123;\n    type: Boolean,\n    default: true\n  &#125;,\n  &#x2F;**\n   * 是否派发滚动事件\n   *&#x2F;\n  listenScroll: &#123;\n    type: Boolean,\n    default: false\n  &#125;,\n  &#x2F;**\n   * 是否派发滚动到底部的事件，用于上拉加载\n   *&#x2F;\n  pullup: &#123;\n    type: Function,\n    default: null\n  &#125;,\n  &#x2F;**\n   * 是否派发顶部下拉的事件，用于下拉刷新\n   *&#x2F;\n  pulldown: &#123;\n    type: Function,\n    default: null\n  &#125;,\n  &#x2F;**\n   * 是否派发列表滚动开始的事件\n   *&#x2F;\n  beforeScroll: &#123;\n    type: Boolean,\n    default: false\n  &#125;,\n  &#x2F;**\n   * 是否派发列表滚动开始的事件\n   *&#x2F;\n  afterScroll: &#123;\n    type: Boolean,\n    default: false\n  &#125;\n&#125;)\n\nonMounted(() &#x3D;&gt; &#123;\n  bscroll &#x3D; new BScroll(wrapper.value, &#123;\n    scrollX: props.scrollX,\n    probeType: props.probeType,\n    click: props.click,\n    observeDOM: true,\n    observeImage: true,\n    mouseWheel: true,\n    pullDownRefresh: true,\n    pullUpLoad: true\n  &#125;)\n  &#x2F;**\n   * 如果开启了滚动前事件派发\n   *&#x2F;\n  if (props.beforeScroll) &#123;\n    bscroll.on(&#39;beforeScrollStart&#39;, () &#x3D;&gt; &#123;\n      emit(&#39;beforeScroll&#39;)\n    &#125;)\n  &#125;\n\n  &#x2F;**\n   * 如果开启了滚动(滚动中)事件派发\n   *&#x2F;\n  if (props.listenScroll) &#123;\n    bscroll.on(&#39;scroll&#39;, (position: &#123; x: number; y: number &#125;) &#x3D;&gt; &#123;\n      emit(&#39;scroll&#39;, position)\n    &#125;)\n  &#125;\n\n  &#x2F;**\n   * 如果开启了滚动结束事件派发\n   *&#x2F;\n  if (props.beforeScroll) &#123;\n    bscroll.on(&#39;scrollEnd&#39;, () &#x3D;&gt; &#123;\n      emit(&#39;afterScroll&#39;)\n    &#125;)\n  &#125;\n\n  if (props.pullup !&#x3D;&#x3D; null) &#123;\n    bscroll.on(&#39;pullingUp&#39;, () &#x3D;&gt; &#123;\n      try &#123;\n        props.pullup().then(() &#x3D;&gt; &#123;\n          bscroll.finishPullUp()\n        &#125;)\n      &#125; catch (e) &#123;\n        &#x2F;&#x2F; 传入非 Promise 函数\n        bscroll.finishPullUp()\n      &#125;\n    &#125;)\n  &#125;\n\n  if (props.pulldown !&#x3D;&#x3D; null) &#123;\n    bscroll.on(&#39;pullingDown&#39;, () &#x3D;&gt; &#123;\n      try &#123;\n        props.pulldown().then(() &#x3D;&gt; &#123;\n          bscroll.finishPullDown()\n        &#125;)\n      &#125; catch (e) &#123;\n        &#x2F;&#x2F; 传入非 Promise 函数\n        bscroll.finishPullDown()\n      &#125;\n    &#125;)\n  &#125;\n&#125;)\n&lt;&#x2F;script&gt;\n\n&lt;style scoped lang&#x3D;&quot;scss&quot;&gt;\n@import &#39;.&#x2F;index.scss&#39;;\n&lt;&#x2F;style&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-scss\" data-language=\"scss\"><code class=\"language-scss\"><span class=\"token selector\">.wrapper </span><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n  <span class=\"token selector\">.content </span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token comment\">// 开启横向滚动</span>\n  <span class=\"token selector\"><span class=\"token parent important\">&amp;</span>.x </span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">white-space</span><span class=\"token punctuation\">:</span> nowrap<span class=\"token punctuation\">;</span>\n    <span class=\"token selector\">.content </span><span class=\"token punctuation\">&#123;</span>\n      <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-block<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>外部使用时需要传入样式指定宽高</p>\n<pre class=\"line-numbers language-html\" data-language=\"html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scroll-view</span> <span class=\"token style-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token style language-css\"><span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 300px<span class=\"token punctuation\">;</span> <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 300px</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>i in count<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>i<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>当前第&#123;&#123; i &#125;&#125;个元素<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scroll-view</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n","categories":[{"name":"Vue","path":"api/categories/Vue.json"},{"name":"初识Vue3","path":"api/categories/初识Vue3.json"}],"tags":[{"name":"Vue3","path":"api/tags/Vue3.json"}]}