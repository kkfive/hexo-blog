{"title":"六、Django学习之基于下划线的跨表查询","slug":"日常学习/技术相关/Python/六、Django学习之基于下划线的跨表查询","date":"2020-01-28T16:00:06.000Z","updated":"2022-02-21T04:45:27.392Z","comments":true,"path":"api/articles/日常学习/技术相关/Python/六、Django学习之基于下划线的跨表查询.json","excerpt":null,"covers":null,"content":"<h1 id=\"六-django学习之基于下划线的跨表查询\"><a class=\"markdownIt-Anchor\" href=\"#六-django学习之基于下划线的跨表查询\"></a> 六、Django学习之基于下划线的跨表查询</h1>\n<h2 id=\"一对一\"><a class=\"markdownIt-Anchor\" href=\"#一对一\"></a> 一对一</h2>\n<p>正向查询的例子为 已知用户名，查询用户的电话号码。反向查询例子反之。</p>\n<h3 id=\"正向查询\"><a class=\"markdownIt-Anchor\" href=\"#正向查询\"></a> 正向查询</h3>\n<p>其中下划线前的表示表名，无下划线的表示的是Author表</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Author<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">\"authorDetail__telephone\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'age'</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"反向查询\"><a class=\"markdownIt-Anchor\" href=\"#反向查询\"></a> 反向查询</h3>\n<p>values可以不写，则去除能拿到的全部数据。filter中的双下划线表示<strong>联表</strong></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AuthorDetail<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>author__name<span class=\"token operator\">=</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'telephone'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"一对多\"><a class=\"markdownIt-Anchor\" href=\"#一对多\"></a> 一对多</h2>\n<h3 id=\"正向查询-2\"><a class=\"markdownIt-Anchor\" href=\"#正向查询-2\"></a> 正向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Book<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>title<span class=\"token operator\">=</span><span class=\"token string\">'第一本书'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">\"publishs__name\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"反向查询-2\"><a class=\"markdownIt-Anchor\" href=\"#反向查询-2\"></a> 反向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Publish<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>book__title<span class=\"token operator\">=</span><span class=\"token string\">'第一本书'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"多对多\"><a class=\"markdownIt-Anchor\" href=\"#多对多\"></a> 多对多</h2>\n<h3 id=\"正向查询-3\"><a class=\"markdownIt-Anchor\" href=\"#正向查询-3\"></a> 正向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">obj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Publish<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">\"book__title\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"反向查询-3\"><a class=\"markdownIt-Anchor\" href=\"#反向查询-3\"></a> 反向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">obj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Book<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>publishs__name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"进阶使用\"><a class=\"markdownIt-Anchor\" href=\"#进阶使用\"></a> 进阶使用</h2>\n<h3 id=\"三表联查\"><a class=\"markdownIt-Anchor\" href=\"#三表联查\"></a> 三表联查</h3>\n<p>查询老男人出版社出版的书的名字和作者的名字</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">obj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Book<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>publishs__name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'authors__name'</span><span class=\"token punctuation\">)</span>\nobj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Publish<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'book__title'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'book__authors__name'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"关于反向查询代替字段\"><a class=\"markdownIt-Anchor\" href=\"#关于反向查询代替字段\"></a> 关于反向查询代替字段</h3>\n<p>在创建表是外键字段添加参数<code>related_name</code></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    nid <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    title <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span> max_length<span class=\"token operator\">=</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span>\n    publishDate<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    price<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>DecimalField<span class=\"token punctuation\">(</span>max_digits<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span>decimal_places<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">#decimal(16,2)</span>\n    publishs<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>to<span class=\"token operator\">=</span><span class=\"token string\">\"Publish\"</span><span class=\"token punctuation\">,</span>related_name<span class=\"token operator\">=</span><span class=\"token string\">'xx'</span><span class=\"token punctuation\">)</span>\n    authors<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>ManyToManyField<span class=\"token punctuation\">(</span>to<span class=\"token operator\">=</span><span class=\"token string\">'Author'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","more":"<h1 id=\"六-django学习之基于下划线的跨表查询\"><a class=\"markdownIt-Anchor\" href=\"#六-django学习之基于下划线的跨表查询\"></a> 六、Django学习之基于下划线的跨表查询</h1>\n<h2 id=\"一对一\"><a class=\"markdownIt-Anchor\" href=\"#一对一\"></a> 一对一</h2>\n<p>正向查询的例子为 已知用户名，查询用户的电话号码。反向查询例子反之。</p>\n<h3 id=\"正向查询\"><a class=\"markdownIt-Anchor\" href=\"#正向查询\"></a> 正向查询</h3>\n<p>其中下划线前的表示表名，无下划线的表示的是Author表</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Author<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">\"authorDetail__telephone\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'age'</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"反向查询\"><a class=\"markdownIt-Anchor\" href=\"#反向查询\"></a> 反向查询</h3>\n<p>values可以不写，则去除能拿到的全部数据。filter中的双下划线表示<strong>联表</strong></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AuthorDetail<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>author__name<span class=\"token operator\">=</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'telephone'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"一对多\"><a class=\"markdownIt-Anchor\" href=\"#一对多\"></a> 一对多</h2>\n<h3 id=\"正向查询-2\"><a class=\"markdownIt-Anchor\" href=\"#正向查询-2\"></a> 正向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Book<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>title<span class=\"token operator\">=</span><span class=\"token string\">'第一本书'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">\"publishs__name\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"反向查询-2\"><a class=\"markdownIt-Anchor\" href=\"#反向查询-2\"></a> 反向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">result <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Publish<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>book__title<span class=\"token operator\">=</span><span class=\"token string\">'第一本书'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"多对多\"><a class=\"markdownIt-Anchor\" href=\"#多对多\"></a> 多对多</h2>\n<h3 id=\"正向查询-3\"><a class=\"markdownIt-Anchor\" href=\"#正向查询-3\"></a> 正向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">obj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Publish<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">\"book__title\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"反向查询-3\"><a class=\"markdownIt-Anchor\" href=\"#反向查询-3\"></a> 反向查询</h3>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">obj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Book<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>publishs__name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"进阶使用\"><a class=\"markdownIt-Anchor\" href=\"#进阶使用\"></a> 进阶使用</h2>\n<h3 id=\"三表联查\"><a class=\"markdownIt-Anchor\" href=\"#三表联查\"></a> 三表联查</h3>\n<p>查询老男人出版社出版的书的名字和作者的名字</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">obj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Book<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>publishs__name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'authors__name'</span><span class=\"token punctuation\">)</span>\nobj <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>Publish<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'老男人出版社'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'book__title'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'book__authors__name'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"关于反向查询代替字段\"><a class=\"markdownIt-Anchor\" href=\"#关于反向查询代替字段\"></a> 关于反向查询代替字段</h3>\n<p>在创建表是外键字段添加参数<code>related_name</code></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    nid <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    title <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span> max_length<span class=\"token operator\">=</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span>\n    publishDate<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    price<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>DecimalField<span class=\"token punctuation\">(</span>max_digits<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span>decimal_places<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">#decimal(16,2)</span>\n    publishs<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>to<span class=\"token operator\">=</span><span class=\"token string\">\"Publish\"</span><span class=\"token punctuation\">,</span>related_name<span class=\"token operator\">=</span><span class=\"token string\">'xx'</span><span class=\"token punctuation\">)</span>\n    authors<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>ManyToManyField<span class=\"token punctuation\">(</span>to<span class=\"token operator\">=</span><span class=\"token string\">'Author'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","categories":[{"name":"Python","path":"api/categories/Python.json"},{"name":"Django的ORM操作","path":"api/categories/Django的ORM操作.json"}],"tags":[{"name":"Python","path":"api/tags/Python.json"},{"name":"Django","path":"api/tags/Django.json"}]}