{"title":"Hexo记一次gulp压缩体验","slug":"Hexo相关/功能扩展/Hexo记一次gulp压缩","date":"2020-04-28T11:18:07.000Z","updated":"2022-02-21T04:45:27.384Z","comments":true,"path":"api/articles/Hexo相关/功能扩展/Hexo记一次gulp压缩.json","excerpt":null,"covers":null,"content":"<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\"></a> 前言</h2>\n<p>其实呢，这次体验没有理想中好。因为主页的大小只下降了0.7kb。</p>\n<p>对于我的博客来说，我的全部静态文件都在GitHub上，并且使用jsdeliver加速引用。因此对我来说真正压缩的其实也就是html。</p>\n<p>但是考虑到还有coding的持续集成，因此也要考虑持续集成的环境配置。</p>\n<h2 id=\"gulpfile配置\"><a class=\"markdownIt-Anchor\" href=\"#gulpfile配置\"></a> gulpfile配置</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gulp\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp --save\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-htmlclean\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-htmlmin\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-clean-css\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-uglify<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 引入需要的模块</span>\n<span class=\"token keyword\">var</span> gulp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> minifycss <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-clean-css'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> uglify <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-uglify'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> htmlmin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-htmlmin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> htmlclean <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-htmlclean'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 压缩public目录下所有html文件, minify-html是任务名, 设置为default，启动gulp压缩的时候可以省去任务名</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-html'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public/**/*.html'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 压缩文件所在的目录</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">htmlclean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">htmlmin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n            removeComments<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            minifyJS<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            minifyCSS<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            minifyURLs<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 输出的目录</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 压缩css</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-css'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public/**/*.css'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">minifycss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n            compatibility<span class=\"token operator\">:</span> <span class=\"token string\">'ie8'</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 压缩js</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'./public/**/.js'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'!./public/js/**/*min.js'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">uglify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 默认任务</span>\n<span class=\"token comment\">/*\ngulp.task('default', [\n    'minify-html','minify-html1','minify-css','minify-js','minify-images'\n]);\n*/</span>\n<span class=\"token comment\">// gulp 4.0 适用的方式</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">parallel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-html'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'minify-css'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'minify-js'</span>\n <span class=\"token comment\">//build the website</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"coding持续集成配置\"><a class=\"markdownIt-Anchor\" href=\"#coding持续集成配置\"></a> coding持续集成配置</h2>\n<pre class=\"line-numbers language-Jenkinsfile\" data-language=\"Jenkinsfile\"><code class=\"language-Jenkinsfile\">pipeline &#123;\n  agent any\n  stages &#123;\n    stage(&#39;克隆项目&#39;) &#123;\n      steps &#123;\n        sh &#39;git clone 项目地址 .&#39;\n        sh &#39;ls -a&#39;\n      &#125;\n    &#125;\n    stage(&#39;安装Hexo依赖&#39;) &#123;\n      steps &#123;\n        sh &#39;ls -a&#39;\n        sh &#39;npm install -g hexo-cli&#39;\n        sh &#39;npm install hexo --save&#39;\n      &#125;\n    &#125;\nstage(&#39;安装gulp依赖&#39;) &#123;\n      steps &#123;\n        sh &#39;ls -a&#39;\n        sh &#39;npm install -g gulp&#39;\n        sh &#39;npm install gulp --save&#39;\n        sh &#39;npm install gulp-htmlclean&#39;\n        sh &#39;npm install gulp-htmlmin&#39;\n        sh &#39;npm install gulp-clean-css&#39;\n        sh &#39;npm install gulp-uglify&#39;\n      &#125;\n    &#125;\n    stage(&#39;构建发布&#39;) &#123;\n      steps &#123;\n        sh &#39;hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d&#39;\n      &#125;\n    &#125;\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"最后\"><a class=\"markdownIt-Anchor\" href=\"#最后\"></a> 最后</h2>\n<p>虽然效果不明显，且会导致构建时间增加。但我还是使用了，理由很简单。</p>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>能少一点是一点</p></div>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>查看源代码时看到密密麻麻的一片比分散的舒服</p></div>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>coding的构建是按次数的，并不是按时间算</p></div>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>目前coding的政策每周200次，每次30分钟。次数周一重置</p></div>\n<p>综上所述，时间到达三分钟也不会超过30分钟的限制。因此对于持续集成环境多一分钟就多一分钟，反正自己后台慢慢整嘛。</p>\n","more":"<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\"></a> 前言</h2>\n<p>其实呢，这次体验没有理想中好。因为主页的大小只下降了0.7kb。</p>\n<p>对于我的博客来说，我的全部静态文件都在GitHub上，并且使用jsdeliver加速引用。因此对我来说真正压缩的其实也就是html。</p>\n<p>但是考虑到还有coding的持续集成，因此也要考虑持续集成的环境配置。</p>\n<h2 id=\"gulpfile配置\"><a class=\"markdownIt-Anchor\" href=\"#gulpfile配置\"></a> gulpfile配置</h2>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gulp\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp --save\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-htmlclean\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-htmlmin\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-clean-css\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp-uglify<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 引入需要的模块</span>\n<span class=\"token keyword\">var</span> gulp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> minifycss <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-clean-css'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> uglify <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-uglify'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> htmlmin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-htmlmin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> htmlclean <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-htmlclean'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 压缩public目录下所有html文件, minify-html是任务名, 设置为default，启动gulp压缩的时候可以省去任务名</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-html'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public/**/*.html'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 压缩文件所在的目录</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">htmlclean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">htmlmin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n            removeComments<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            minifyJS<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            minifyCSS<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            minifyURLs<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 输出的目录</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 压缩css</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-css'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public/**/*.css'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">minifycss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n            compatibility<span class=\"token operator\">:</span> <span class=\"token string\">'ie8'</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 压缩js</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'./public/**/.js'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'!./public/js/**/*min.js'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">uglify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 默认任务</span>\n<span class=\"token comment\">/*\ngulp.task('default', [\n    'minify-html','minify-html1','minify-css','minify-js','minify-images'\n]);\n*/</span>\n<span class=\"token comment\">// gulp 4.0 适用的方式</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">parallel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'minify-html'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'minify-css'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'minify-js'</span>\n <span class=\"token comment\">//build the website</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"coding持续集成配置\"><a class=\"markdownIt-Anchor\" href=\"#coding持续集成配置\"></a> coding持续集成配置</h2>\n<pre class=\"line-numbers language-Jenkinsfile\" data-language=\"Jenkinsfile\"><code class=\"language-Jenkinsfile\">pipeline &#123;\n  agent any\n  stages &#123;\n    stage(&#39;克隆项目&#39;) &#123;\n      steps &#123;\n        sh &#39;git clone 项目地址 .&#39;\n        sh &#39;ls -a&#39;\n      &#125;\n    &#125;\n    stage(&#39;安装Hexo依赖&#39;) &#123;\n      steps &#123;\n        sh &#39;ls -a&#39;\n        sh &#39;npm install -g hexo-cli&#39;\n        sh &#39;npm install hexo --save&#39;\n      &#125;\n    &#125;\nstage(&#39;安装gulp依赖&#39;) &#123;\n      steps &#123;\n        sh &#39;ls -a&#39;\n        sh &#39;npm install -g gulp&#39;\n        sh &#39;npm install gulp --save&#39;\n        sh &#39;npm install gulp-htmlclean&#39;\n        sh &#39;npm install gulp-htmlmin&#39;\n        sh &#39;npm install gulp-clean-css&#39;\n        sh &#39;npm install gulp-uglify&#39;\n      &#125;\n    &#125;\n    stage(&#39;构建发布&#39;) &#123;\n      steps &#123;\n        sh &#39;hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d&#39;\n      &#125;\n    &#125;\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"最后\"><a class=\"markdownIt-Anchor\" href=\"#最后\"></a> 最后</h2>\n<p>虽然效果不明显，且会导致构建时间增加。但我还是使用了，理由很简单。</p>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>能少一点是一点</p></div>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>查看源代码时看到密密麻麻的一片比分散的舒服</p></div>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>coding的构建是按次数的，并不是按时间算</p></div>\n<div class=\"checkbox green checked\"><input type=\"checkbox\" checked=\"checked\"><p>目前coding的政策每周200次，每次30分钟。次数周一重置</p></div>\n<p>综上所述，时间到达三分钟也不会超过30分钟的限制。因此对于持续集成环境多一分钟就多一分钟，反正自己后台慢慢整嘛。</p>\n","categories":[{"name":"Hexo","path":"api/categories/Hexo.json"},{"name":"功能增强","path":"api/categories/功能增强.json"}],"tags":[{"name":"Hexo","path":"api/tags/Hexo.json"},{"name":"gulp","path":"api/tags/gulp.json"}]}