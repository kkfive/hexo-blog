{"title":"三、MongoDB高级操作","slug":"日常学习/技术相关/MongoDB/三、MongoDB高级操作","date":"2020-07-08T07:40:01.000Z","updated":"2022-02-21T04:45:27.392Z","comments":true,"path":"api/articles/日常学习/技术相关/MongoDB/三、MongoDB高级操作.json","excerpt":null,"covers":["https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0b38307896f164dc7b238767097b75f1.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d9e185ef995d75f34e5c29d5bc474995.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/f6bcb99223cc2b1d3625b46d4badcfde.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/205a1a751f517c4e6de7c5407b6f2dba.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2f7207ad362f00f73338996b37f0d230.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/cfbc913cf45edd10ab6c634e4a0f513b.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/eee07bbb7d085b680b191fdd8f1bb7f6.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/43e548555ac3392875c7b9bc9071dab9.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3226e9823ee931019fc17624240a1ad7.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/998b9712108e8cfe5a001008a9f25e1f.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/67f890d0d5059ccc5911d996a0679bc7.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d08e4b45600b66873e1a6ce85b4278d7.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/afd37c1004926e9fa901a1b75a800ca7.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/7ea13aaaf35e33ee32ee461302827d04.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3b6da821731c957898d4cffaf5b9cada.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/5c8ee2a15576986ecf6b51d58f19bf37.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d1ddc74838fc6cf32cc23dd1bfc06f4c.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/32d2576f7eb3d5e82dfc1f1db2876f0e.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0947a790438763a9cb8d704e19cf878f.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/1bf6e474540d958f6c35e2657aeb4538.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/726d94a691bda354dcc54293fe01d4fa.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/bc8cd4b11dd94f25f4efb1a89385d4b7.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/27c57fc89d5d45777079f91b24e9dc60.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/c5eb5ab076d1a0b2c5021bb8691e5e44.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2dbd144506222baa8ff4fd756c1ac6b3.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/bde0980c7c9f04748b9759fbfd192cba.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/068889a84c79f41946a1cecbad15796b.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/6692eedca2023ba1c8de6d7777c997e8.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2b35fe35278d973ad26f3c56dbadfde3.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3d4e688cdb597cdb8237f14af0678c09.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0552455db9fa3b1488a98b0640f5096c.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/b33481db34f6899bf390f3a04de1eb2d.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/9a42fd0116b05bfbc0df5de0fb93f138.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/cce481ae808b9ef343a32a4112efa3e7.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/e1384458a97e83e9f8f9cb9eab2b66e4.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/b2600ee9838edf9324e5812dbf217659.png","https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0871373441d60aa034b06cf5b839801c.png"],"content":"<h2 id=\"排序分页\"><a class=\"markdownIt-Anchor\" href=\"#排序分页\"></a> 排序&amp;分页</h2>\n<p>准备数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> test3\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">2</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">3</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">3</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">4</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">4</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">5</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">5</span>&#125;<span class=\"token punctuation\">)</span>\n\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"排序\"><a class=\"markdownIt-Anchor\" href=\"#排序\"></a> 排序</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>JSON数据<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0b38307896f164dc7b238767097b75f1.png\" alt=\"image-20200708154749926\" /></p>\n<h3 id=\"limit与skip方法\"><a class=\"markdownIt-Anchor\" href=\"#limit与skip方法\"></a> Limit与Skip方法</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span>数字<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span>数字<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>skip跳过指定数量（可选）</li>\n<li>limit限制查询的数量</li>\n</ul>\n<blockquote>\n<p>使用<code>.count()</code>可以统计数量</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d9e185ef995d75f34e5c29d5bc474995.png\" alt=\"image-20200708155902088\" /></p>\n</blockquote>\n<h3 id=\"实例练习\"><a class=\"markdownIt-Anchor\" href=\"#实例练习\"></a> 实例练习</h3>\n<ol>\n<li>\n<p>跳过0条数据，查询两条</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>&#123;age:<span class=\"token operator\">-</span><span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>&#123;age:<span class=\"token operator\">-</span><span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/f6bcb99223cc2b1d3625b46d4badcfde.png\" alt=\"image-20200708155135127\" /></p>\n</li>\n<li>\n<p>跳过两条数据，查询两条数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>&#123;age:<span class=\"token operator\">-</span><span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/205a1a751f517c4e6de7c5407b6f2dba.png\" alt=\"image-20200708155409337\" /></p>\n</li>\n<li>\n<p>数据库1-10数据，每页显示两条</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>skip计算公式：（当前页-1）* 每页显示条数</p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"聚合查询\"><a class=\"markdownIt-Anchor\" href=\"#聚合查询\"></a> 聚合查询</h2>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>聚合名称<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;管道:&#123;表达式&#125;&#125;\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">常用管道</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>$group</code></td>\n<td style=\"text-align:center\">将集合中的文档分组，用于统计结果</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$match</code></td>\n<td style=\"text-align:center\">过滤数据，只要输出符合条件的文档</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$sort</code></td>\n<td style=\"text-align:center\">聚合数据进一步排序</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$skip</code></td>\n<td style=\"text-align:center\">跳过指定文档数</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$limit</code></td>\n<td style=\"text-align:center\">限制集合数据返回文档数</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">常用表达式</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>$sum</code></td>\n<td style=\"text-align:center\">总和  <code>$sum:1</code>同<code>count</code>表示统计</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$avg</code></td>\n<td style=\"text-align:center\">平均</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$min</code></td>\n<td style=\"text-align:center\">最小值</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$max</code></td>\n<td style=\"text-align:center\">最大值</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"实例练习-2\"><a class=\"markdownIt-Anchor\" href=\"#实例练习-2\"></a> 实例练习</h3>\n<p>准备数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> test4\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">2</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">3</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">3</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">4</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">4</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">5</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">5</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p><code>_id</code>键表示按哪一个字段分组，需要显示的列新增字段即可。</p>\n</blockquote>\n<ol>\n<li>\n<p>统计男生、女生的总年龄</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;\n        $<span class=\"token keyword\">group</span>:&#123;\n        _id:<span class=\"token string\">\"$sex\"</span><span class=\"token punctuation\">,</span>\n        rs:&#123;$sum:<span class=\"token string\">\"$age\"</span>&#125;\n        &#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2f7207ad362f00f73338996b37f0d230.png\" alt=\"image-20200708162849482\" /></p>\n</li>\n<li>\n<p>统计男生、女生的总人数</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;\n        $<span class=\"token keyword\">group</span>:&#123;\n        _id:<span class=\"token string\">\"$sex\"</span><span class=\"token punctuation\">,</span>\n        rs:&#123;$sum:<span class=\"token number\">1</span>&#125;\n        &#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li>\n<p>求学生总数和平均年龄</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n&#123;\n    $<span class=\"token keyword\">group</span>:&#123;\n    _id:<span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n    total_num:&#123;$sum:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">,</span>\n    total_avg:&#123;$avg:<span class=\"token string\">\"$age\"</span>&#125;\n    &#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/cfbc913cf45edd10ab6c634e4a0f513b.png\" alt=\"image-20200708163511493\" /></p>\n</li>\n<li>\n<p>查询男生、女生人数，按人数升序</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;\n        $<span class=\"token keyword\">group</span>:&#123;\n        _id:<span class=\"token string\">\"$sex\"</span><span class=\"token punctuation\">,</span>\n        rs:&#123;$sum:<span class=\"token number\">1</span>&#125;\n        &#125;\n    &#125;<span class=\"token punctuation\">,</span>\n    &#123;\n        $sort:&#123;rs:<span class=\"token number\">1</span>&#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ol>\n<h2 id=\"索引\"><a class=\"markdownIt-Anchor\" href=\"#索引\"></a> 索引</h2>\n<p><span class=\"inline-tag blue\">创建索引</span></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>带创建索引的列<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>额外选项<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>\n<p>带创建索引的列:{键:1,键:-1}</p>\n<p>1表示升序，-1表示降序</p>\n</li>\n<li>\n<p>额外选项</p>\n<p>设置索引的名称或者唯一索引等等</p>\n</li>\n</ul>\n<p><span class=\"inline-tag blue\">删除索引</span></p>\n<ul>\n<li>\n<p>全部删除</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>dropIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li>\n<p>删除指定</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>dropIndex<span class=\"token punctuation\">(</span>索引名<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n</ul>\n<p><span class=\"inline-tag blue\">查看索引语法</span></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"实例练习-3\"><a class=\"markdownIt-Anchor\" href=\"#实例练习-3\"></a> 实例练习</h3>\n<p>数据准备</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token comment\">//选择数据库</span>\n<span class=\"token keyword\">use</span> test5<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//向数据库中添加数据</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>var i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">100000</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">+</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>&#123;\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;<span class=\"token string\">'name'</span>:<span class=\"token string\">\"aaa\"</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span><span class=\"token string\">\"age\"</span>:i&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/eee07bbb7d085b680b191fdd8f1bb7f6.png\" alt=\"image-20200708170010949\" /></p>\n<ol>\n<li>\n<p>给name添加普通索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>&#123;name:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/43e548555ac3392875c7b9bc9071dab9.png\" alt=\"1585476182255\" /></p>\n</li>\n<li>\n<p>删除name索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>dropIndex<span class=\"token punctuation\">(</span><span class=\"token string\">'name_1'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3226e9823ee931019fc17624240a1ad7.png\" alt=\"image-20200708170307519\" /></p>\n</li>\n<li>\n<p>给name创建索引并起名webopenfather</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>&#123;name:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">,</span>&#123;name:<span class=\"token string\">'webopenfather'</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/998b9712108e8cfe5a001008a9f25e1f.png\" alt=\"image-20200708170412526\" /></p>\n</li>\n<li>\n<p>创建复合/组合索引</p>\n<p>给name和age添加组合索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>&#123;name:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/67f890d0d5059ccc5911d996a0679bc7.png\" alt=\"image-20200708170624911\" /></p>\n</li>\n<li>\n<p>创建唯一索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>待添加索引的列<span class=\"token punctuation\">,</span>&#123;<span class=\"token keyword\">unique</span>:列名&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n</ol>\n<h3 id=\"分析索引explain\"><a class=\"markdownIt-Anchor\" href=\"#分析索引explain\"></a> 分析索引（explain）</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">explain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'executionStats'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d08e4b45600b66873e1a6ce85b4278d7.png\" alt=\"1585461681918\" /></p>\n<blockquote>\n<p>COLLSCAN 全表扫描<br />\nIXSCAN  索引扫描<br />\nFETCH   根据索引去检索指定document</p>\n</blockquote>\n<blockquote>\n<p>测试：age未添加索引情况<br />\n语法：db.c1.find({age:18}).explain(‘executionStats’);</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/afd37c1004926e9fa901a1b75a800ca7.png\" alt=\"1585477310460\" /></p>\n<p>测试：age添加索引情况<br />\n语法：db.c1.createIndex({age: 1})<br />\n继续：db.c1.find({age:18}).explain(‘executionStats’)<br />\n<img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/7ea13aaaf35e33ee32ee461302827d04.png\" alt=\"1585477412871\" /></p>\n</blockquote>\n<h3 id=\"选择规则\"><a class=\"markdownIt-Anchor\" href=\"#选择规则\"></a> 选择规则</h3>\n<ul>\n<li>\n<p>为常做条件、排序、分组的字段建立索引</p>\n</li>\n<li>\n<p>选择唯一性索引</p>\n<p>同值较少如性别字段</p>\n</li>\n<li>\n<p>选择较小的数据列，为较长的字符串使用前缀索引</p>\n<p>索引文件更小</p>\n</li>\n</ul>\n<h2 id=\"mongodb权限机制\"><a class=\"markdownIt-Anchor\" href=\"#mongodb权限机制\"></a> MongoDB权限机制</h2>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"账号\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"密码\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"角色\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"所属数据库\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">角色种类</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">超级用户角色</td>\n<td style=\"text-align:center\"><code>root</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据库用户角色</td>\n<td style=\"text-align:center\"><code>read</code>、<code>readWrite</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据库管理角色</td>\n<td style=\"text-align:center\"><code>dbAdmin</code>、<code>userAdmin</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">集群管理角色</td>\n<td style=\"text-align:center\"><code>clusterAdmin</code>、<code>clusterManager</code>、<code>clusterMonitor</code>、<code>hostManager</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">备份恢复角色</td>\n<td style=\"text-align:center\"><code>backup</code>、<code>restore</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">所有数据库角色</td>\n<td style=\"text-align:center\"><code>readAnyDatabase</code>、<code>readWriteAnyDatabase</code>、<code>userAdminAnyDatabase</code>、<code>dbAdminAnyDatabase</code></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">角色</th>\n<th style=\"text-align:center\">角色说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>root</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用。超级账号，超级权限；</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>read</code></td>\n<td style=\"text-align:center\">允许用户读取指定数据库</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>readWrite</code></td>\n<td style=\"text-align:center\">允许用户读写指定数据库</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>dbAdmin</code></td>\n<td style=\"text-align:center\">允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile；</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>dbAdminAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>clusterAdmin</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>userAdmin</code></td>\n<td style=\"text-align:center\">允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>userAdminAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>readAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的读权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>readWriteAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的读写权限</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"开启验证模式\"><a class=\"markdownIt-Anchor\" href=\"#开启验证模式\"></a> 开启验证模式</h3>\n<ol>\n<li>\n<p>添加超级管理员</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> admin\ndb<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"admin\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3b6da821731c957898d4cffaf5b9cada.png\" alt=\"image-20200708173257120\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/5c8ee2a15576986ecf6b51d58f19bf37.png\" alt=\"image-20200708173457799\" /></p>\n</li>\n<li>\n<p>退出卸载服务</p>\n<p>需要使用管理员模式打开终端</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongod --remove<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d1ddc74838fc6cf32cc23dd1bfc06f4c.png\" alt=\"image-20200708173734958\" /></p>\n</li>\n<li>\n<p>重新安装需要输入账号密码的服务</p>\n<p>在原安装命令基础上加<code>--auth</code>即可</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongod --install --dbpath F:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>data --logpath F:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>logs<span class=\"token punctuation\">\\</span>mongoDB2.log --auth<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/32d2576f7eb3d5e82dfc1f1db2876f0e.png\" alt=\"image-20200708173918620\" /></p>\n</li>\n<li>\n<p>启动服务</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">net start mongodb<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0947a790438763a9cb8d704e19cf878f.png\" alt=\"image-20200708173935044\" /></p>\n</li>\n</ol>\n<h3 id=\"通过超级管理员账号登陆\"><a class=\"markdownIt-Anchor\" href=\"#通过超级管理员账号登陆\"></a> 通过超级管理员账号登陆</h3>\n<ol>\n<li>\n<p>第一种方式</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongo 服务器IP地址:端口<span class=\"token operator\">/</span>数据库 <span class=\"token operator\">-</span>u 用户名 <span class=\"token operator\">-</span>p 密码<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/1bf6e474540d958f6c35e2657aeb4538.png\" alt=\"image-20200708174319993\" /></p>\n</li>\n<li>\n<p>第二种方式</p>\n<ul>\n<li>先登录</li>\n<li>选择数据库</li>\n<li>输入<code>db.auth(用户名,密码)</code></li>\n</ul>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/726d94a691bda354dcc54293fe01d4fa.png\" alt=\"image-20200708174425029\" /></p>\n</li>\n</ol>\n<h3 id=\"实例练习-4\"><a class=\"markdownIt-Anchor\" href=\"#实例练习-4\"></a> 实例练习</h3>\n<p>准备数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> shop<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>var i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;=</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">+</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span> &#123;\n db<span class=\"token punctuation\">.</span>goods<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;<span class=\"token string\">\"name\"</span>:<span class=\"token string\">\"goodsName\"</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span><span class=\"token string\">\"price\"</span>:i&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<ol>\n<li>\n<p>添加用户并设置权限</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> shop\n\n<span class=\"token comment\">// 只能读</span>\ndb<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"shop1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"shop1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"read\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"shop\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 只能写</span>\ndb<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"shop2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"shop2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"readWrite\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"shop\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/bc8cd4b11dd94f25f4efb1a89385d4b7.png\" alt=\"image-20200708174755182\" /></p>\n</li>\n</ol>\n<h2 id=\"备份还原\"><a class=\"markdownIt-Anchor\" href=\"#备份还原\"></a> 备份还原</h2>\n<h3 id=\"备份\"><a class=\"markdownIt-Anchor\" href=\"#备份\"></a> 备份</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongodump <span class=\"token operator\">-</span>h <span class=\"token operator\">-</span>port <span class=\"token operator\">-</span>u <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>o<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>-h表示服务器IP地址（不写默认本机）</li>\n<li>-port表示端口（默认27017）</li>\n<li>-u表示账号</li>\n<li>-p表示密码</li>\n<li>-d表示数据库（数据库不写则导出全部）</li>\n<li>-o备份到指定目录ia</li>\n</ul>\n<ol>\n<li>\n<p>备份<strong>所有数据</strong>到<code>F:\\MongoDB\\back</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongodump -u root -p root -o F:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>back<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/27c57fc89d5d45777079f91b24e9dc60.png\" alt=\"image-20200708175626591\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/c5eb5ab076d1a0b2c5021bb8691e5e44.png\" alt=\"image-20200708175638005\" /></p>\n</li>\n<li>\n<p>备份<strong>指定数据</strong>到<code>F:\\MongoDB\\back1</code></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongodump <span class=\"token operator\">-</span>u shop2 <span class=\"token operator\">-</span>p shop2 <span class=\"token operator\">-</span>d shop <span class=\"token operator\">-</span>o F:\\MongoDB\\back1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>因为数据库是属于shop1与shop2的，因此导出需要使用这两个账号。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2dbd144506222baa8ff4fd756c1ac6b3.png\" alt=\"image-20200708180050665\" /></p>\n</li>\n</ol>\n<h3 id=\"还原数据\"><a class=\"markdownIt-Anchor\" href=\"#还原数据\"></a> 还原数据</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongorestore <span class=\"token operator\">-</span>h <span class=\"token operator\">-</span>port <span class=\"token operator\">-</span>u <span class=\"token operator\">-</span>p <span class=\"token comment\">--drop -d</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>-d 不写则还原全部数据</li>\n<li>–drop表示先删除在导出，不写则覆盖</li>\n</ul>\n<ol>\n<li>\n<p>还原所有数据</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/bde0980c7c9f04748b9759fbfd192cba.png\" alt=\"image-20200708180544852\" /></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongorestore <span class=\"token operator\">-</span>u root <span class=\"token operator\">-</span>p root <span class=\"token comment\">--drop F:\\MongoDB\\back</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/068889a84c79f41946a1cecbad15796b.png\" alt=\"image-20200708180657258\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/6692eedca2023ba1c8de6d7777c997e8.png\" alt=\"image-20200708180708196\" /></p>\n</li>\n<li>\n<p>备份指定数据库</p>\n<p>备份指定数据库，不能使用root账户，需要使用有写权限的账户。且需要指定具体文件名。</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongorestore <span class=\"token operator\">-</span>u shop2 <span class=\"token operator\">-</span>p shop2 <span class=\"token operator\">-</span>d shop <span class=\"token comment\">--drop F:\\MongoDB\\back1\\shop</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2b35fe35278d973ad26f3c56dbadfde3.png\" alt=\"image-20200708181317726\" /></p>\n</li>\n</ol>\n<h2 id=\"可视化工具\"><a class=\"markdownIt-Anchor\" href=\"#可视化工具\"></a> 可视化工具</h2>\n<p><a href=\"https://robomongo.org/download\">Robo 3T</a></p>\n<h3 id=\"安装\"><a class=\"markdownIt-Anchor\" href=\"#安装\"></a> 安装</h3>\n<ol>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3d4e688cdb597cdb8237f14af0678c09.png\" alt=\"image-20200708181718492\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0552455db9fa3b1488a98b0640f5096c.png\" alt=\"image-20200708181725531\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/b33481db34f6899bf390f3a04de1eb2d.png\" alt=\"image-20200708181738210\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/9a42fd0116b05bfbc0df5de0fb93f138.png\" alt=\"image-20200708181744557\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/cce481ae808b9ef343a32a4112efa3e7.png\" alt=\"image-20200708181753490\" /></li>\n</ol>\n<h3 id=\"使用\"><a class=\"markdownIt-Anchor\" href=\"#使用\"></a> 使用</h3>\n<ol>\n<li>\n<p>创建链接</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/e1384458a97e83e9f8f9cb9eab2b66e4.png\" alt=\"image-20200708181900681\" /></p>\n</li>\n<li>\n<p>授权</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/b2600ee9838edf9324e5812dbf217659.png\" alt=\"image-20200708182040323\" /></p>\n</li>\n<li>\n<p>此时可以看到所有数据库</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0871373441d60aa034b06cf5b839801c.png\" alt=\"image-20200708182120705\" /></p>\n</li>\n</ol>\n<blockquote>\n<p>对于可视化工具，我个人更喜欢Navicat</p>\n</blockquote>\n","more":"<h2 id=\"排序分页\"><a class=\"markdownIt-Anchor\" href=\"#排序分页\"></a> 排序&amp;分页</h2>\n<p>准备数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> test3\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">2</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">3</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">3</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">4</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">4</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">5</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">5</span>&#125;<span class=\"token punctuation\">)</span>\n\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"排序\"><a class=\"markdownIt-Anchor\" href=\"#排序\"></a> 排序</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>JSON数据<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0b38307896f164dc7b238767097b75f1.png\" alt=\"image-20200708154749926\" /></p>\n<h3 id=\"limit与skip方法\"><a class=\"markdownIt-Anchor\" href=\"#limit与skip方法\"></a> Limit与Skip方法</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span>数字<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span>数字<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>skip跳过指定数量（可选）</li>\n<li>limit限制查询的数量</li>\n</ul>\n<blockquote>\n<p>使用<code>.count()</code>可以统计数量</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d9e185ef995d75f34e5c29d5bc474995.png\" alt=\"image-20200708155902088\" /></p>\n</blockquote>\n<h3 id=\"实例练习\"><a class=\"markdownIt-Anchor\" href=\"#实例练习\"></a> 实例练习</h3>\n<ol>\n<li>\n<p>跳过0条数据，查询两条</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>&#123;age:<span class=\"token operator\">-</span><span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>&#123;age:<span class=\"token operator\">-</span><span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/f6bcb99223cc2b1d3625b46d4badcfde.png\" alt=\"image-20200708155135127\" /></p>\n</li>\n<li>\n<p>跳过两条数据，查询两条数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>&#123;age:<span class=\"token operator\">-</span><span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/205a1a751f517c4e6de7c5407b6f2dba.png\" alt=\"image-20200708155409337\" /></p>\n</li>\n<li>\n<p>数据库1-10数据，每页显示两条</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>skip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">limit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>skip计算公式：（当前页-1）* 每页显示条数</p>\n</blockquote>\n</li>\n</ol>\n<h2 id=\"聚合查询\"><a class=\"markdownIt-Anchor\" href=\"#聚合查询\"></a> 聚合查询</h2>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>聚合名称<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;管道:&#123;表达式&#125;&#125;\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">常用管道</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>$group</code></td>\n<td style=\"text-align:center\">将集合中的文档分组，用于统计结果</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$match</code></td>\n<td style=\"text-align:center\">过滤数据，只要输出符合条件的文档</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$sort</code></td>\n<td style=\"text-align:center\">聚合数据进一步排序</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$skip</code></td>\n<td style=\"text-align:center\">跳过指定文档数</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$limit</code></td>\n<td style=\"text-align:center\">限制集合数据返回文档数</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">常用表达式</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>$sum</code></td>\n<td style=\"text-align:center\">总和  <code>$sum:1</code>同<code>count</code>表示统计</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$avg</code></td>\n<td style=\"text-align:center\">平均</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$min</code></td>\n<td style=\"text-align:center\">最小值</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>$max</code></td>\n<td style=\"text-align:center\">最大值</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"实例练习-2\"><a class=\"markdownIt-Anchor\" href=\"#实例练习-2\"></a> 实例练习</h3>\n<p>准备数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> test4\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">2</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">3</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">3</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">4</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">4</span>&#125;<span class=\"token punctuation\">)</span>\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;_id:<span class=\"token number\">5</span><span class=\"token punctuation\">,</span>name:<span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span>sex:<span class=\"token number\">2</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">5</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p><code>_id</code>键表示按哪一个字段分组，需要显示的列新增字段即可。</p>\n</blockquote>\n<ol>\n<li>\n<p>统计男生、女生的总年龄</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;\n        $<span class=\"token keyword\">group</span>:&#123;\n        _id:<span class=\"token string\">\"$sex\"</span><span class=\"token punctuation\">,</span>\n        rs:&#123;$sum:<span class=\"token string\">\"$age\"</span>&#125;\n        &#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2f7207ad362f00f73338996b37f0d230.png\" alt=\"image-20200708162849482\" /></p>\n</li>\n<li>\n<p>统计男生、女生的总人数</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;\n        $<span class=\"token keyword\">group</span>:&#123;\n        _id:<span class=\"token string\">\"$sex\"</span><span class=\"token punctuation\">,</span>\n        rs:&#123;$sum:<span class=\"token number\">1</span>&#125;\n        &#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li>\n<p>求学生总数和平均年龄</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n&#123;\n    $<span class=\"token keyword\">group</span>:&#123;\n    _id:<span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n    total_num:&#123;$sum:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">,</span>\n    total_avg:&#123;$avg:<span class=\"token string\">\"$age\"</span>&#125;\n    &#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/cfbc913cf45edd10ab6c634e4a0f513b.png\" alt=\"image-20200708163511493\" /></p>\n</li>\n<li>\n<p>查询男生、女生人数，按人数升序</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    &#123;\n        $<span class=\"token keyword\">group</span>:&#123;\n        _id:<span class=\"token string\">\"$sex\"</span><span class=\"token punctuation\">,</span>\n        rs:&#123;$sum:<span class=\"token number\">1</span>&#125;\n        &#125;\n    &#125;<span class=\"token punctuation\">,</span>\n    &#123;\n        $sort:&#123;rs:<span class=\"token number\">1</span>&#125;\n    &#125;\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n</ol>\n<h2 id=\"索引\"><a class=\"markdownIt-Anchor\" href=\"#索引\"></a> 索引</h2>\n<p><span class=\"inline-tag blue\">创建索引</span></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>带创建索引的列<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>额外选项<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>\n<p>带创建索引的列:{键:1,键:-1}</p>\n<p>1表示升序，-1表示降序</p>\n</li>\n<li>\n<p>额外选项</p>\n<p>设置索引的名称或者唯一索引等等</p>\n</li>\n</ul>\n<p><span class=\"inline-tag blue\">删除索引</span></p>\n<ul>\n<li>\n<p>全部删除</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>dropIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li>\n<p>删除指定</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>dropIndex<span class=\"token punctuation\">(</span>索引名<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n</ul>\n<p><span class=\"inline-tag blue\">查看索引语法</span></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>getIndexes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"实例练习-3\"><a class=\"markdownIt-Anchor\" href=\"#实例练习-3\"></a> 实例练习</h3>\n<p>数据准备</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token comment\">//选择数据库</span>\n<span class=\"token keyword\">use</span> test5<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//向数据库中添加数据</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>var i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">100000</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">+</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>&#123;\ndb<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;<span class=\"token string\">'name'</span>:<span class=\"token string\">\"aaa\"</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span><span class=\"token string\">\"age\"</span>:i&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/eee07bbb7d085b680b191fdd8f1bb7f6.png\" alt=\"image-20200708170010949\" /></p>\n<ol>\n<li>\n<p>给name添加普通索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>&#123;name:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/43e548555ac3392875c7b9bc9071dab9.png\" alt=\"1585476182255\" /></p>\n</li>\n<li>\n<p>删除name索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>dropIndex<span class=\"token punctuation\">(</span><span class=\"token string\">'name_1'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3226e9823ee931019fc17624240a1ad7.png\" alt=\"image-20200708170307519\" /></p>\n</li>\n<li>\n<p>给name创建索引并起名webopenfather</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>&#123;name:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">,</span>&#123;name:<span class=\"token string\">'webopenfather'</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/998b9712108e8cfe5a001008a9f25e1f.png\" alt=\"image-20200708170412526\" /></p>\n</li>\n<li>\n<p>创建复合/组合索引</p>\n<p>给name和age添加组合索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>&#123;name:<span class=\"token number\">1</span><span class=\"token punctuation\">,</span>age:<span class=\"token number\">1</span>&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/67f890d0d5059ccc5911d996a0679bc7.png\" alt=\"image-20200708170624911\" /></p>\n</li>\n<li>\n<p>创建唯一索引</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>c1<span class=\"token punctuation\">.</span>createIndex<span class=\"token punctuation\">(</span>待添加索引的列<span class=\"token punctuation\">,</span>&#123;<span class=\"token keyword\">unique</span>:列名&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n</ol>\n<h3 id=\"分析索引explain\"><a class=\"markdownIt-Anchor\" href=\"#分析索引explain\"></a> 分析索引（explain）</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>集合名<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">explain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'executionStats'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d08e4b45600b66873e1a6ce85b4278d7.png\" alt=\"1585461681918\" /></p>\n<blockquote>\n<p>COLLSCAN 全表扫描<br />\nIXSCAN  索引扫描<br />\nFETCH   根据索引去检索指定document</p>\n</blockquote>\n<blockquote>\n<p>测试：age未添加索引情况<br />\n语法：db.c1.find({age:18}).explain(‘executionStats’);</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/afd37c1004926e9fa901a1b75a800ca7.png\" alt=\"1585477310460\" /></p>\n<p>测试：age添加索引情况<br />\n语法：db.c1.createIndex({age: 1})<br />\n继续：db.c1.find({age:18}).explain(‘executionStats’)<br />\n<img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/7ea13aaaf35e33ee32ee461302827d04.png\" alt=\"1585477412871\" /></p>\n</blockquote>\n<h3 id=\"选择规则\"><a class=\"markdownIt-Anchor\" href=\"#选择规则\"></a> 选择规则</h3>\n<ul>\n<li>\n<p>为常做条件、排序、分组的字段建立索引</p>\n</li>\n<li>\n<p>选择唯一性索引</p>\n<p>同值较少如性别字段</p>\n</li>\n<li>\n<p>选择较小的数据列，为较长的字符串使用前缀索引</p>\n<p>索引文件更小</p>\n</li>\n</ul>\n<h2 id=\"mongodb权限机制\"><a class=\"markdownIt-Anchor\" href=\"#mongodb权限机制\"></a> MongoDB权限机制</h2>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"账号\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"密码\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"角色\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"所属数据库\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">角色种类</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">超级用户角色</td>\n<td style=\"text-align:center\"><code>root</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据库用户角色</td>\n<td style=\"text-align:center\"><code>read</code>、<code>readWrite</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据库管理角色</td>\n<td style=\"text-align:center\"><code>dbAdmin</code>、<code>userAdmin</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">集群管理角色</td>\n<td style=\"text-align:center\"><code>clusterAdmin</code>、<code>clusterManager</code>、<code>clusterMonitor</code>、<code>hostManager</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">备份恢复角色</td>\n<td style=\"text-align:center\"><code>backup</code>、<code>restore</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">所有数据库角色</td>\n<td style=\"text-align:center\"><code>readAnyDatabase</code>、<code>readWriteAnyDatabase</code>、<code>userAdminAnyDatabase</code>、<code>dbAdminAnyDatabase</code></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">角色</th>\n<th style=\"text-align:center\">角色说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>root</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用。超级账号，超级权限；</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>read</code></td>\n<td style=\"text-align:center\">允许用户读取指定数据库</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>readWrite</code></td>\n<td style=\"text-align:center\">允许用户读写指定数据库</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>dbAdmin</code></td>\n<td style=\"text-align:center\">允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile；</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>dbAdminAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>clusterAdmin</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>userAdmin</code></td>\n<td style=\"text-align:center\">允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>userAdminAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>readAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的读权限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>readWriteAnyDatabase</code></td>\n<td style=\"text-align:center\">只在admin数据库中可用，赋予用户所有数据库的读写权限</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"开启验证模式\"><a class=\"markdownIt-Anchor\" href=\"#开启验证模式\"></a> 开启验证模式</h3>\n<ol>\n<li>\n<p>添加超级管理员</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> admin\ndb<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"admin\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3b6da821731c957898d4cffaf5b9cada.png\" alt=\"image-20200708173257120\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/5c8ee2a15576986ecf6b51d58f19bf37.png\" alt=\"image-20200708173457799\" /></p>\n</li>\n<li>\n<p>退出卸载服务</p>\n<p>需要使用管理员模式打开终端</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongod --remove<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/d1ddc74838fc6cf32cc23dd1bfc06f4c.png\" alt=\"image-20200708173734958\" /></p>\n</li>\n<li>\n<p>重新安装需要输入账号密码的服务</p>\n<p>在原安装命令基础上加<code>--auth</code>即可</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongod --install --dbpath F:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>data --logpath F:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>logs<span class=\"token punctuation\">\\</span>mongoDB2.log --auth<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/32d2576f7eb3d5e82dfc1f1db2876f0e.png\" alt=\"image-20200708173918620\" /></p>\n</li>\n<li>\n<p>启动服务</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">net start mongodb<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0947a790438763a9cb8d704e19cf878f.png\" alt=\"image-20200708173935044\" /></p>\n</li>\n</ol>\n<h3 id=\"通过超级管理员账号登陆\"><a class=\"markdownIt-Anchor\" href=\"#通过超级管理员账号登陆\"></a> 通过超级管理员账号登陆</h3>\n<ol>\n<li>\n<p>第一种方式</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongo 服务器IP地址:端口<span class=\"token operator\">/</span>数据库 <span class=\"token operator\">-</span>u 用户名 <span class=\"token operator\">-</span>p 密码<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/1bf6e474540d958f6c35e2657aeb4538.png\" alt=\"image-20200708174319993\" /></p>\n</li>\n<li>\n<p>第二种方式</p>\n<ul>\n<li>先登录</li>\n<li>选择数据库</li>\n<li>输入<code>db.auth(用户名,密码)</code></li>\n</ul>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/726d94a691bda354dcc54293fe01d4fa.png\" alt=\"image-20200708174425029\" /></p>\n</li>\n</ol>\n<h3 id=\"实例练习-4\"><a class=\"markdownIt-Anchor\" href=\"#实例练习-4\"></a> 实例练习</h3>\n<p>准备数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> shop<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>var i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;=</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">+</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span> &#123;\n db<span class=\"token punctuation\">.</span>goods<span class=\"token punctuation\">.</span><span class=\"token keyword\">insert</span><span class=\"token punctuation\">(</span>&#123;<span class=\"token string\">\"name\"</span>:<span class=\"token string\">\"goodsName\"</span><span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span><span class=\"token string\">\"price\"</span>:i&#125;<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<ol>\n<li>\n<p>添加用户并设置权限</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">use</span> shop\n\n<span class=\"token comment\">// 只能读</span>\ndb<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"shop1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"shop1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"read\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"shop\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 只能写</span>\ndb<span class=\"token punctuation\">.</span>createUser<span class=\"token punctuation\">(</span>&#123; \n    <span class=\"token string\">\"user\"</span> : <span class=\"token string\">\"shop2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"pwd\"</span>: <span class=\"token string\">\"shop2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"roles\"</span> : <span class=\"token punctuation\">[</span>&#123; \n        role: <span class=\"token string\">\"readWrite\"</span><span class=\"token punctuation\">,</span> \n        db: <span class=\"token string\">\"shop\"</span>\n    &#125;<span class=\"token punctuation\">]</span> \n&#125;<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/bc8cd4b11dd94f25f4efb1a89385d4b7.png\" alt=\"image-20200708174755182\" /></p>\n</li>\n</ol>\n<h2 id=\"备份还原\"><a class=\"markdownIt-Anchor\" href=\"#备份还原\"></a> 备份还原</h2>\n<h3 id=\"备份\"><a class=\"markdownIt-Anchor\" href=\"#备份\"></a> 备份</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongodump <span class=\"token operator\">-</span>h <span class=\"token operator\">-</span>port <span class=\"token operator\">-</span>u <span class=\"token operator\">-</span>p <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>o<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>-h表示服务器IP地址（不写默认本机）</li>\n<li>-port表示端口（默认27017）</li>\n<li>-u表示账号</li>\n<li>-p表示密码</li>\n<li>-d表示数据库（数据库不写则导出全部）</li>\n<li>-o备份到指定目录ia</li>\n</ul>\n<ol>\n<li>\n<p>备份<strong>所有数据</strong>到<code>F:\\MongoDB\\back</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongodump -u root -p root -o F:<span class=\"token punctuation\">\\</span>MongoDB<span class=\"token punctuation\">\\</span>back<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/27c57fc89d5d45777079f91b24e9dc60.png\" alt=\"image-20200708175626591\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/c5eb5ab076d1a0b2c5021bb8691e5e44.png\" alt=\"image-20200708175638005\" /></p>\n</li>\n<li>\n<p>备份<strong>指定数据</strong>到<code>F:\\MongoDB\\back1</code></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongodump <span class=\"token operator\">-</span>u shop2 <span class=\"token operator\">-</span>p shop2 <span class=\"token operator\">-</span>d shop <span class=\"token operator\">-</span>o F:\\MongoDB\\back1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>因为数据库是属于shop1与shop2的，因此导出需要使用这两个账号。</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2dbd144506222baa8ff4fd756c1ac6b3.png\" alt=\"image-20200708180050665\" /></p>\n</li>\n</ol>\n<h3 id=\"还原数据\"><a class=\"markdownIt-Anchor\" href=\"#还原数据\"></a> 还原数据</h3>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongorestore <span class=\"token operator\">-</span>h <span class=\"token operator\">-</span>port <span class=\"token operator\">-</span>u <span class=\"token operator\">-</span>p <span class=\"token comment\">--drop -d</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ul>\n<li>-d 不写则还原全部数据</li>\n<li>–drop表示先删除在导出，不写则覆盖</li>\n</ul>\n<ol>\n<li>\n<p>还原所有数据</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/bde0980c7c9f04748b9759fbfd192cba.png\" alt=\"image-20200708180544852\" /></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongorestore <span class=\"token operator\">-</span>u root <span class=\"token operator\">-</span>p root <span class=\"token comment\">--drop F:\\MongoDB\\back</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/068889a84c79f41946a1cecbad15796b.png\" alt=\"image-20200708180657258\" /></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/6692eedca2023ba1c8de6d7777c997e8.png\" alt=\"image-20200708180708196\" /></p>\n</li>\n<li>\n<p>备份指定数据库</p>\n<p>备份指定数据库，不能使用root账户，需要使用有写权限的账户。且需要指定具体文件名。</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">mongorestore <span class=\"token operator\">-</span>u shop2 <span class=\"token operator\">-</span>p shop2 <span class=\"token operator\">-</span>d shop <span class=\"token comment\">--drop F:\\MongoDB\\back1\\shop</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/2b35fe35278d973ad26f3c56dbadfde3.png\" alt=\"image-20200708181317726\" /></p>\n</li>\n</ol>\n<h2 id=\"可视化工具\"><a class=\"markdownIt-Anchor\" href=\"#可视化工具\"></a> 可视化工具</h2>\n<p><a href=\"https://robomongo.org/download\">Robo 3T</a></p>\n<h3 id=\"安装\"><a class=\"markdownIt-Anchor\" href=\"#安装\"></a> 安装</h3>\n<ol>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/3d4e688cdb597cdb8237f14af0678c09.png\" alt=\"image-20200708181718492\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0552455db9fa3b1488a98b0640f5096c.png\" alt=\"image-20200708181725531\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/b33481db34f6899bf390f3a04de1eb2d.png\" alt=\"image-20200708181738210\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/9a42fd0116b05bfbc0df5de0fb93f138.png\" alt=\"image-20200708181744557\" /></li>\n<li><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/cce481ae808b9ef343a32a4112efa3e7.png\" alt=\"image-20200708181753490\" /></li>\n</ol>\n<h3 id=\"使用\"><a class=\"markdownIt-Anchor\" href=\"#使用\"></a> 使用</h3>\n<ol>\n<li>\n<p>创建链接</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/e1384458a97e83e9f8f9cb9eab2b66e4.png\" alt=\"image-20200708181900681\" /></p>\n</li>\n<li>\n<p>授权</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/b2600ee9838edf9324e5812dbf217659.png\" alt=\"image-20200708182040323\" /></p>\n</li>\n<li>\n<p>此时可以看到所有数据库</p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile2@latest/2020/07/08/0871373441d60aa034b06cf5b839801c.png\" alt=\"image-20200708182120705\" /></p>\n</li>\n</ol>\n<blockquote>\n<p>对于可视化工具，我个人更喜欢Navicat</p>\n</blockquote>\n","categories":[{"name":"MongoDB","path":"api/categories/MongoDB.json"}],"tags":[{"name":"MongoDB","path":"api/tags/MongoDB.json"}]}