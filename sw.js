"use strict";function t(t,n,e,i){return new(e||(e=Promise))((function(o,c){function s(t){try{r(i.next(t))}catch(t){c(t)}}function d(t){try{r(i.throw(t))}catch(t){c(t)}}function r(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,d)}r((i=i.apply(t,n||[])).next())}))}const n={originSite:["https://www.antmoe.com","https://kkfive.github.io","https://kkfive.gitee.io"],cdnSiteList:{gh:{jsdelivr:"https://cdn.jsdelivr.net/gh",pigax_jsd:"https://u.pigax.cn/gh",pigax_chenyfan_jsd:"https://cdn-jsd.pigax.cn/gh",tianli:"https://cdn1.tianli0.top/gh",acs:"https://file2.antmoe.com/gh",acs1:"https://file2.acs.pw/gh"},combine:{jsdelivr:"https://cdn.jsdelivr.net/combine",pigax_jsd:"https://u.pigax.cn/combine",pigax_chenyfan_jsd:"https://cdn-jsd.pigax.cn/combine",tianli:"https://cdn1.tianli0.top/combine"},npm:{eleme:"https://npm.elemecdn.com",jsdelivr:"https://cdn.jsdelivr.net/npm",zhimg:"https://unpkg.zhimg.com",unpkg:"https://unpkg.com",pigax_jsd:"https://u.pigax.cn/npm",pigax_unpkg:"https://unpkg.pigax.cn/",pigax_chenyfan_jsd:"https://cdn-jsd.pigax.cn/npm",tianli:"https://cdn1.tianli0.top/npm"}},cacheDomainList:[/(https?:\/\/)rmt\.ladydaily\.com/g,/(https?:\/\/)rmt\.dogedoge\.com/g,/(https?:\/\/)file\.acs\.pw/g,/(https?:\/\/)bu\.dusays\.com/g,/(https?:\/\/)lf6-cdn-tos\.bytecdntp\.com/g,/(https?:\/\/)static\.jsd\.antmoe\.com/g,/(https?:\/\/)dogefs\.s3\.ladydaily\.com/g],cacheName:"KKChacheHelper",cacheList:["/404.html","/favicon.ico"]},e=n.cacheName,i=n=>new Promise(((e,i)=>t(void 0,void 0,void 0,(function*(){try{const t=yield caches.match(new Request(`https://LOCALCACHE/${encodeURIComponent(n)}`));t||e(null),null==t||t.text().then((t=>e(t)))}catch(t){e(null)}})))),o=(n,i)=>new Promise(((o,c)=>t(void 0,void 0,void 0,(function*(){try{(yield caches.open(e)).put(new Request(`https://LOCALCACHE/${encodeURIComponent(n)}`),new Response(i)),o(!0)}catch(t){c()}})))),c=(n,i)=>t(void 0,void 0,void 0,(function*(){if(!i||"GET"!==n.method)return i;const t=yield caches.open(e);try{yield t.put(n,i.clone())}catch(t){}return i})),s=n=>t(void 0,void 0,void 0,(function*(){const t=yield caches.open(e);return yield t.match(n)}));function d(n){return t(this,void 0,void 0,(function*(){return new Response(yield n.arrayBuffer(),{status:n.status,headers:n.headers})}))}function h(n){const e=new AbortController,i=e.signal,o=n.map((n=>t(this,void 0,void 0,(function*(){const o=function(){return t(this,void 0,void 0,(function*(){return(yield s(new Request("/404.html")))||new Response("<b>请求错误，请稍后尝试</b>",{headers:{"content-type":"text/html; charset=utf-8"},status:500})}))}();return new Promise(((c,s)=>t(this,void 0,void 0,(function*(){fetch(n.url,{signal:i,method:n.methods,body:n.body}).then(d).then((n=>{const i=n.clone();i.status>=200&&i.status<=400?(setTimeout((()=>t(this,void 0,void 0,(function*(){}))),0),e.abort(),c(i)):s(o)})).catch((()=>s(o)))}))))}))));return Promise.any(o).then((t=>t)).catch((()=>null))}function r(t){return fetch(t)}function u({request:n,urlList:e=[]}){return t(this,void 0,void 0,(function*(){const{url:t,method:i,body:o}=n;if(!function(t){return/(^http|https:\/\/)/g.test(t)}(n.url))return r(n);if(e.length){const t=yield h(e);return t?c(n,t):s(new Request("/404.html"))}try{const t=yield r(n);return 200===t.status?c(n,t):t}catch(t){return s(new Request("/404.html"))}}))}const a=self;a.addEventListener("install",(e=>t(void 0,void 0,void 0,(function*(){yield a.skipWaiting(),e.waitUntil(caches.open(n.cacheName).then((function(e){return t(this,void 0,void 0,(function*(){return(yield i("uuid"))||(yield o("uuid","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=16*Math.random()|0;return("x"==t?n:3&n|8).toString(16)})))),e.addAll(n.cacheList)}))})))})))),a.addEventListener("activate",(n=>t(void 0,void 0,void 0,(function*(){yield a.clients.claim()})))),a.addEventListener("fetch",(e=>t(void 0,void 0,void 0,(function*(){e.respondWith(function(e){return t(this,void 0,void 0,(function*(){const{url:t,method:i,body:o}=e,c=yield s(e),d=function(t){let e=!1;if(!t)return e;const i=n.cacheDomainList;for(let o=0;o<n.cacheDomainList.length;o++)if(t.match(i[o])){e=!0;break}return e}(t),r=function(t,e,i){const o=[],c=n.cdnSiteList;let{pathname:s,hostname:d,search:r,origin:a}=new URL(t);const h=s.split("/")[1];if(c[h])for(const t in c[h]){const n=c[h][t]+s.replace("/"+h,"");o.push({url:n+r,methods:e,body:i})}return n.originSite.includes(a)&&n.originSite.forEach((t=>{o.push({url:t+s+r,methods:e,body:i})})),o}(t,i,o);return c?(setTimeout((()=>{d||u({request:e,urlList:r})})),c):u({request:e,urlList:r})}))}(e.request))}))));