{"title":"Github之Actions自动发布GitHub Release","slug":"日常学习/部署与构建/Actions/GithubActions自动发布GitHub Release","date":"2021-01-18T11:13:00.000Z","updated":"2021-01-18T11:13:00.000Z","comments":true,"path":"api/articles/日常学习/部署与构建/Actions/GithubActions自动发布GitHub Release.json","excerpt":null,"covers":null,"content":"<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\"></a> 前言</h2>\n<p>此文以node项目为例，目录存在<code>package.json</code>，其他项目如果参考本教程需自行创建json文件用于记录当前版本。</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1.1.1\"</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<div class=\"note danger modern\"><p>上述代码仅作为JSON文件示例。</p>\n</div>\n<p>先来看看actions官方提供的发布demo</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 创建GitHub Release\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_release\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/create<span class=\"token punctuation\">-</span>release@latest\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> tag的名称\n    <span class=\"token key atrule\">release_name</span><span class=\"token punctuation\">:</span> 发布的名字\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> 发布的内容\n    <span class=\"token key atrule\">draft</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">prerelease</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>以上几个需要我们自己填写的只有<code>tag_name</code>、<code>release_name</code>、<code>body</code>。因此我们只需要动态获取这三个变量即可实现按照我们的需求进行发布。</p>\n<h2 id=\"获取tag_name\"><a class=\"markdownIt-Anchor\" href=\"#获取tag_name\"></a> 获取tag_name</h2>\n<p>tag_name一般指的是版本号，也就是需要在我们的JSON文件中读取的信息。</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 读取当前版本号\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> version\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> ashley<span class=\"token punctuation\">-</span>taylor/read<span class=\"token punctuation\">-</span>json<span class=\"token punctuation\">-</span>property<span class=\"token punctuation\">-</span>action@v1.0\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./package.json\n    <span class=\"token key atrule\">property</span><span class=\"token punctuation\">:</span> version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>\n<p><code>path</code></p>\n<p>表示Json文件的路径</p>\n</li>\n<li>\n<p><code>property</code></p>\n<p>json文件里的属性名。</p>\n</li>\n</ul>\n<p>所以上述步骤表示读取<code>./package.json</code>文件里的<code>version</code>字段，也就是开头JSON示例中<code>1.1.1</code>值。</p>\n<h2 id=\"获取release_name\"><a class=\"markdownIt-Anchor\" href=\"#获取release_name\"></a> 获取release_name</h2>\n<p>也就是发布release的名称，一般为<code>xxx-</code>版本号这样的格式，因此我们可以直接用版本号作为发布名。</p>\n<h2 id=\"获取body\"><a class=\"markdownIt-Anchor\" href=\"#获取body\"></a> 获取body</h2>\n<p>由于body的内容较多，因此我们单独创建一个文件用于记录本次发布的内容。</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 读取描述文件\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> description\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> juliangruber/read<span class=\"token punctuation\">-</span>file<span class=\"token punctuation\">-</span>action@v1\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./description.txt<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>\n<p><code>path</code></p>\n<p>表示文件的路径</p>\n</li>\n</ul>\n<p>这样下来我们的三个字段就全部获取完了。接下来只需要发布即可</p>\n<h2 id=\"发布release\"><a class=\"markdownIt-Anchor\" href=\"#发布release\"></a> 发布release</h2>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 创建GitHub Release\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_release\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/create<span class=\"token punctuation\">-</span>release@latest\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token key atrule\">release_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.description.outputs.content<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token key atrule\">draft</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">prerelease</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>$&#123;&#123;steps.version.outputs.value&#125;&#125;</code>可以输出获取json文件时读取到的值，<code>$&#123;&#123;steps.description.outputs.content&#125;&#125;</code>可以输出获取文本内容时读取到的值。</p>\n<h2 id=\"完整代码含npm包发布\"><a class=\"markdownIt-Anchor\" href=\"#完整代码含npm包发布\"></a> 完整代码（含NPM包发布）</h2>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Node.js Package\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">publish-npm</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>12.x<span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># check it to your workflow can access it</span>\n      <span class=\"token comment\"># from: https://github.com/actions/checkout</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 1. 检查master分支\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@master\n\n      <span class=\"token comment\"># from: https://github.com/actions/setup-node</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 2. 设置Node.js\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@master\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 3. 缓存\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v2\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> cache<span class=\"token punctuation\">-</span>dependencies\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> node_modules\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>runner.OS<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>hashFiles('<span class=\"token important\">**/yarn.lock')</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 4. 安装插件\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> steps.cache<span class=\"token punctuation\">-</span>dependencies.outputs.cache<span class=\"token punctuation\">-</span>hit <span class=\"token tag\">!=</span> 'true'\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          export TZ='Asia/Shanghai'\n          yarn install</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 5. 生成文件\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          export TZ='Asia/Shanghai'\n          node index.js</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 6. 读取当前版本号\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> version\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> ashley<span class=\"token punctuation\">-</span>taylor/read<span class=\"token punctuation\">-</span>json<span class=\"token punctuation\">-</span>property<span class=\"token punctuation\">-</span>action@v1.0\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./package.json\n          <span class=\"token key atrule\">property</span><span class=\"token punctuation\">:</span> version\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 7. 读取描述文件\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> description\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> juliangruber/read<span class=\"token punctuation\">-</span>file<span class=\"token punctuation\">-</span>action@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./description.txt\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 8. 发布NPM包\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          npm config set //registry.npmjs.org/:_authToken=$NPM_TOKEN\n          npm publish</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">NPM_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>secrets.NPM_TOKEN<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 9. 创建GitHub Release\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_release\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/create<span class=\"token punctuation\">-</span>release@latest\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n          <span class=\"token key atrule\">release_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n          <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.description.outputs.content<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n          <span class=\"token key atrule\">draft</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n          <span class=\"token key atrule\">prerelease</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 10. 刷新缓存\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          curl https://purge.jsdelivr.net/npm/iemotion-pic@latest/dist/name.json</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","more":"<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\"></a> 前言</h2>\n<p>此文以node项目为例，目录存在<code>package.json</code>，其他项目如果参考本教程需自行创建json文件用于记录当前版本。</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\"><span class=\"token punctuation\">&#123;</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1.1.1\"</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<div class=\"note danger modern\"><p>上述代码仅作为JSON文件示例。</p>\n</div>\n<p>先来看看actions官方提供的发布demo</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 创建GitHub Release\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_release\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/create<span class=\"token punctuation\">-</span>release@latest\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> tag的名称\n    <span class=\"token key atrule\">release_name</span><span class=\"token punctuation\">:</span> 发布的名字\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> 发布的内容\n    <span class=\"token key atrule\">draft</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">prerelease</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>以上几个需要我们自己填写的只有<code>tag_name</code>、<code>release_name</code>、<code>body</code>。因此我们只需要动态获取这三个变量即可实现按照我们的需求进行发布。</p>\n<h2 id=\"获取tag_name\"><a class=\"markdownIt-Anchor\" href=\"#获取tag_name\"></a> 获取tag_name</h2>\n<p>tag_name一般指的是版本号，也就是需要在我们的JSON文件中读取的信息。</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 读取当前版本号\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> version\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> ashley<span class=\"token punctuation\">-</span>taylor/read<span class=\"token punctuation\">-</span>json<span class=\"token punctuation\">-</span>property<span class=\"token punctuation\">-</span>action@v1.0\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./package.json\n    <span class=\"token key atrule\">property</span><span class=\"token punctuation\">:</span> version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>\n<p><code>path</code></p>\n<p>表示Json文件的路径</p>\n</li>\n<li>\n<p><code>property</code></p>\n<p>json文件里的属性名。</p>\n</li>\n</ul>\n<p>所以上述步骤表示读取<code>./package.json</code>文件里的<code>version</code>字段，也就是开头JSON示例中<code>1.1.1</code>值。</p>\n<h2 id=\"获取release_name\"><a class=\"markdownIt-Anchor\" href=\"#获取release_name\"></a> 获取release_name</h2>\n<p>也就是发布release的名称，一般为<code>xxx-</code>版本号这样的格式，因此我们可以直接用版本号作为发布名。</p>\n<h2 id=\"获取body\"><a class=\"markdownIt-Anchor\" href=\"#获取body\"></a> 获取body</h2>\n<p>由于body的内容较多，因此我们单独创建一个文件用于记录本次发布的内容。</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 读取描述文件\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> description\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> juliangruber/read<span class=\"token punctuation\">-</span>file<span class=\"token punctuation\">-</span>action@v1\n  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./description.txt<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li>\n<p><code>path</code></p>\n<p>表示文件的路径</p>\n</li>\n</ul>\n<p>这样下来我们的三个字段就全部获取完了。接下来只需要发布即可</p>\n<h2 id=\"发布release\"><a class=\"markdownIt-Anchor\" href=\"#发布release\"></a> 发布release</h2>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 创建GitHub Release\n  <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_release\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/create<span class=\"token punctuation\">-</span>release@latest\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token key atrule\">release_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.description.outputs.content<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token key atrule\">draft</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">prerelease</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>$&#123;&#123;steps.version.outputs.value&#125;&#125;</code>可以输出获取json文件时读取到的值，<code>$&#123;&#123;steps.description.outputs.content&#125;&#125;</code>可以输出获取文本内容时读取到的值。</p>\n<h2 id=\"完整代码含npm包发布\"><a class=\"markdownIt-Anchor\" href=\"#完整代码含npm包发布\"></a> 完整代码（含NPM包发布）</h2>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Node.js Package\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">publish-npm</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>12.x<span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># check it to your workflow can access it</span>\n      <span class=\"token comment\"># from: https://github.com/actions/checkout</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 1. 检查master分支\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@master\n\n      <span class=\"token comment\"># from: https://github.com/actions/setup-node</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 2. 设置Node.js\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@master\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> matrix.node<span class=\"token punctuation\">-</span>version <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 3. 缓存\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v2\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> cache<span class=\"token punctuation\">-</span>dependencies\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> node_modules\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>runner.OS<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>hashFiles('<span class=\"token important\">**/yarn.lock')</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 4. 安装插件\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> steps.cache<span class=\"token punctuation\">-</span>dependencies.outputs.cache<span class=\"token punctuation\">-</span>hit <span class=\"token tag\">!=</span> 'true'\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          export TZ='Asia/Shanghai'\n          yarn install</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 5. 生成文件\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          export TZ='Asia/Shanghai'\n          node index.js</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 6. 读取当前版本号\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> version\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> ashley<span class=\"token punctuation\">-</span>taylor/read<span class=\"token punctuation\">-</span>json<span class=\"token punctuation\">-</span>property<span class=\"token punctuation\">-</span>action@v1.0\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./package.json\n          <span class=\"token key atrule\">property</span><span class=\"token punctuation\">:</span> version\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 7. 读取描述文件\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> description\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> juliangruber/read<span class=\"token punctuation\">-</span>file<span class=\"token punctuation\">-</span>action@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ./description.txt\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 8. 发布NPM包\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          npm config set //registry.npmjs.org/:_authToken=$NPM_TOKEN\n          npm publish</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">NPM_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>secrets.NPM_TOKEN<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 9. 创建GitHub Release\n        <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_release\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/create<span class=\"token punctuation\">-</span>release@latest\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n          <span class=\"token key atrule\">release_name</span><span class=\"token punctuation\">:</span> v$<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.version.outputs.value<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n          <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#123;</span>steps.description.outputs.content<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span>\n          <span class=\"token key atrule\">draft</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n          <span class=\"token key atrule\">prerelease</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> 10. 刷新缓存\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          curl https://purge.jsdelivr.net/npm/iemotion-pic@latest/dist/name.json</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","categories":[{"name":"Github","path":"api/categories/Github.json"}],"tags":[{"name":"Actions","path":"api/tags/Actions.json"}]}