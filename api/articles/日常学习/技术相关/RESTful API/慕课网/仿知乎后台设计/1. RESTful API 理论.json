{"title":"一、RESTful API 理论","slug":"日常学习/技术相关/RESTful API/慕课网/仿知乎后台设计/1. RESTful API 理论","date":"2020-11-22T11:41:26.000Z","updated":"2022-02-21T06:11:10.024Z","comments":true,"path":"api/articles/日常学习/技术相关/RESTful API/慕课网/仿知乎后台设计/1. RESTful API 理论.json","excerpt":null,"covers":null,"content":"<h2 id=\"什么是rest及限制\"><a class=\"markdownIt-Anchor\" href=\"#什么是rest及限制\"></a> 什么是REST及限制</h2>\n<h2 id=\"rest的六个限制\"><a class=\"markdownIt-Anchor\" href=\"#rest的六个限制\"></a> REST的六个限制</h2>\n<ol>\n<li>\n<p>客户-服务器</p>\n<ul>\n<li>\n<p>关注点分离</p>\n</li>\n<li>\n<p>服务端专注数据存储，提升了简单性</p>\n</li>\n<li>\n<p>前端专注用户界面，提升了可移植性</p>\n</li>\n</ul>\n</li>\n<li>\n<p>无状态</p>\n<ul>\n<li>所有用户会话信息都保存在客户端</li>\n<li>每次请求必须包括所有信息，不能依赖上下文信息</li>\n<li>服务端不用保存会话信息，提升了简单性、可靠性、可见性</li>\n</ul>\n</li>\n<li>\n<p>缓存</p>\n<ul>\n<li>所有服务端响应都要被标为可缓存或不可缓存</li>\n<li>减少前后端交互，提升了性能</li>\n</ul>\n</li>\n<li>\n<p>统一接口</p>\n<ul>\n<li>\n<p>接口设计尽可能统一通用，提升了简单性、可见性</p>\n</li>\n<li>\n<p>接口与实现解耦，使前后端可以独立开发迭代</p>\n</li>\n</ul>\n</li>\n<li>\n<p>分层系统</p>\n<ul>\n<li>每层只知道相邻的一层，后面隐藏的就不知道了</li>\n<li>客户端不知道是和代理还是真实服务器通信</li>\n<li>其他层：安全层、负载均衡、缓存层等</li>\n</ul>\n</li>\n<li>\n<p>按需代码</p>\n<ul>\n<li>\n<p>客户端可以下载运行服务端传来的代码（比如JS)</p>\n</li>\n<li>\n<p>通过減少ー些功能，简化了客户端</p>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"统一接口的限制\"><a class=\"markdownIt-Anchor\" href=\"#统一接口的限制\"></a> 统一接口的限制</h3>\n<ol>\n<li>资源的标识</li>\n<li>通过表述来操作资源\n<ul>\n<li>\n<p>表述就是 Representation，比如JSON、XML等</p>\n</li>\n<li>\n<p>客户端不能直接操作（比如SQL）服务端资源</p>\n</li>\n<li>\n<p>客户端应该通过表述（比如JSON）来操作资源</p>\n</li>\n</ul>\n</li>\n<li>自描述消息\n<ul>\n<li>\n<p>每个消息（请求或响应）必须提供足够的信息让接受者理解</p>\n</li>\n<li>\n<p>媒体类型（ application/json、 application/xml)</p>\n</li>\n<li>\n<p>HTTP方法：GET（査）、POST（増）、DELETE（删）</p>\n</li>\n<li>\n<p>是否缓存： Cache-Control</p>\n</li>\n</ul>\n</li>\n<li>超媒体作为应用状态引擎\n<ul>\n<li>\n<p>超媒体：带文字的链接</p>\n</li>\n<li>\n<p>应用状态：一个网页</p>\n</li>\n<li>\n<p>引擎：驱动、跳转</p>\n</li>\n<li>\n<p>合起来：点击链接跳转到另个网页</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"请求设计规范\"><a class=\"markdownIt-Anchor\" href=\"#请求设计规范\"></a> 请求设计规范</h2>\n<ol>\n<li>\n<p>URI使用名词，尽量用复数，如/users</p>\n</li>\n<li>\n<p>URI使用嵌套表示关联关系，如/users/12/repos/5</p>\n</li>\n<li>\n<p>使用正确的HTTP方法，如GET/POST/PUT/DELETE</p>\n</li>\n<li>\n<p>不符合CRUD的情況：POST/action/子资源</p>\n</li>\n</ol>\n<h2 id=\"合理的目录结构\"><a class=\"markdownIt-Anchor\" href=\"#合理的目录结构\"></a> 合理的目录结构</h2>\n<p>将我们的代码放入到<code>app</code>文件下。</p>\n<h3 id=\"路由\"><a class=\"markdownIt-Anchor\" href=\"#路由\"></a> 路由</h3>\n<p>将所有路由放入到<code>routers</code>文件夹下。例如主页路由，新建一个<code>home.js</code>文件</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Router <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa-router'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'主页'</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> router<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>我们在<code>routers</code>文件中新建一个<code>index.js</code>文件，用于注册所有路由文件。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">app</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  fs<span class=\"token punctuation\">.</span><span class=\"token function\">readdirSync</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file <span class=\"token operator\">===</span> <span class=\"token string\">'index.js'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n    <span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>file<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span><span class=\"token function\">routes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后在入口文件引入此文件即可。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> routing <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./routes/index'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">routing</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"控制器\"><a class=\"markdownIt-Anchor\" href=\"#控制器\"></a> 控制器</h3>\n<p>新建<code>controllers</code>文件夹用于存放所有的控制器。例如home的控制器</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeCtl</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token function\">index</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;h1>这是主页&lt;/h1>'</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HomeCtl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>在home的路由中使用这个控制器</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> index <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../controllers/home'</span><span class=\"token punctuation\">)</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"增删改查应该返回什么样的数据\"><a class=\"markdownIt-Anchor\" href=\"#增删改查应该返回什么样的数据\"></a> 增删改查应该返回什么样的数据</h2>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//  查询用户列表</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  获取特定用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  新建用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  修改用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  删除用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token number\">204</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","more":"<h2 id=\"什么是rest及限制\"><a class=\"markdownIt-Anchor\" href=\"#什么是rest及限制\"></a> 什么是REST及限制</h2>\n<h2 id=\"rest的六个限制\"><a class=\"markdownIt-Anchor\" href=\"#rest的六个限制\"></a> REST的六个限制</h2>\n<ol>\n<li>\n<p>客户-服务器</p>\n<ul>\n<li>\n<p>关注点分离</p>\n</li>\n<li>\n<p>服务端专注数据存储，提升了简单性</p>\n</li>\n<li>\n<p>前端专注用户界面，提升了可移植性</p>\n</li>\n</ul>\n</li>\n<li>\n<p>无状态</p>\n<ul>\n<li>所有用户会话信息都保存在客户端</li>\n<li>每次请求必须包括所有信息，不能依赖上下文信息</li>\n<li>服务端不用保存会话信息，提升了简单性、可靠性、可见性</li>\n</ul>\n</li>\n<li>\n<p>缓存</p>\n<ul>\n<li>所有服务端响应都要被标为可缓存或不可缓存</li>\n<li>减少前后端交互，提升了性能</li>\n</ul>\n</li>\n<li>\n<p>统一接口</p>\n<ul>\n<li>\n<p>接口设计尽可能统一通用，提升了简单性、可见性</p>\n</li>\n<li>\n<p>接口与实现解耦，使前后端可以独立开发迭代</p>\n</li>\n</ul>\n</li>\n<li>\n<p>分层系统</p>\n<ul>\n<li>每层只知道相邻的一层，后面隐藏的就不知道了</li>\n<li>客户端不知道是和代理还是真实服务器通信</li>\n<li>其他层：安全层、负载均衡、缓存层等</li>\n</ul>\n</li>\n<li>\n<p>按需代码</p>\n<ul>\n<li>\n<p>客户端可以下载运行服务端传来的代码（比如JS)</p>\n</li>\n<li>\n<p>通过減少ー些功能，简化了客户端</p>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"统一接口的限制\"><a class=\"markdownIt-Anchor\" href=\"#统一接口的限制\"></a> 统一接口的限制</h3>\n<ol>\n<li>资源的标识</li>\n<li>通过表述来操作资源\n<ul>\n<li>\n<p>表述就是 Representation，比如JSON、XML等</p>\n</li>\n<li>\n<p>客户端不能直接操作（比如SQL）服务端资源</p>\n</li>\n<li>\n<p>客户端应该通过表述（比如JSON）来操作资源</p>\n</li>\n</ul>\n</li>\n<li>自描述消息\n<ul>\n<li>\n<p>每个消息（请求或响应）必须提供足够的信息让接受者理解</p>\n</li>\n<li>\n<p>媒体类型（ application/json、 application/xml)</p>\n</li>\n<li>\n<p>HTTP方法：GET（査）、POST（増）、DELETE（删）</p>\n</li>\n<li>\n<p>是否缓存： Cache-Control</p>\n</li>\n</ul>\n</li>\n<li>超媒体作为应用状态引擎\n<ul>\n<li>\n<p>超媒体：带文字的链接</p>\n</li>\n<li>\n<p>应用状态：一个网页</p>\n</li>\n<li>\n<p>引擎：驱动、跳转</p>\n</li>\n<li>\n<p>合起来：点击链接跳转到另个网页</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"请求设计规范\"><a class=\"markdownIt-Anchor\" href=\"#请求设计规范\"></a> 请求设计规范</h2>\n<ol>\n<li>\n<p>URI使用名词，尽量用复数，如/users</p>\n</li>\n<li>\n<p>URI使用嵌套表示关联关系，如/users/12/repos/5</p>\n</li>\n<li>\n<p>使用正确的HTTP方法，如GET/POST/PUT/DELETE</p>\n</li>\n<li>\n<p>不符合CRUD的情況：POST/action/子资源</p>\n</li>\n</ol>\n<h2 id=\"合理的目录结构\"><a class=\"markdownIt-Anchor\" href=\"#合理的目录结构\"></a> 合理的目录结构</h2>\n<p>将我们的代码放入到<code>app</code>文件下。</p>\n<h3 id=\"路由\"><a class=\"markdownIt-Anchor\" href=\"#路由\"></a> 路由</h3>\n<p>将所有路由放入到<code>routers</code>文件夹下。例如主页路由，新建一个<code>home.js</code>文件</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Router <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa-router'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'主页'</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> router<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>我们在<code>routers</code>文件中新建一个<code>index.js</code>文件，用于注册所有路由文件。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">app</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n  fs<span class=\"token punctuation\">.</span><span class=\"token function\">readdirSync</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file <span class=\"token operator\">===</span> <span class=\"token string\">'index.js'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n    <span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>file<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span><span class=\"token function\">routes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后在入口文件引入此文件即可。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> routing <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./routes/index'</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">routing</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"控制器\"><a class=\"markdownIt-Anchor\" href=\"#控制器\"></a> 控制器</h3>\n<p>新建<code>controllers</code>文件夹用于存放所有的控制器。例如home的控制器</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeCtl</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token function\">index</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;h1>这是主页&lt;/h1>'</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HomeCtl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>在home的路由中使用这个控制器</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> index <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../controllers/home'</span><span class=\"token punctuation\">)</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"增删改查应该返回什么样的数据\"><a class=\"markdownIt-Anchor\" href=\"#增删改查应该返回什么样的数据\"></a> 增删改查应该返回什么样的数据</h2>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//  查询用户列表</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  获取特定用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  新建用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  修改用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'李梅'</span> <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//  删除用户</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    ctx<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token number\">204</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","categories":[{"name":"慕课网","path":"api/categories/慕课网.json"},{"name":"RESTful api","path":"api/categories/RESTful api.json"}],"tags":[{"name":"RESTful api","path":"api/tags/RESTful api.json"}]}